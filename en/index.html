<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- SEO: Main meta tags -->
    <title>
      Islamic Inheritance Calculator | Calculate Shares According to Sharia
      Online
    </title>
    <meta
      name="description"
      content="Free online Islamic inheritance calculator. Calculate heir shares according to Quran and Sunnah: furud, asaba, al-awl, ar-radd. Accurate Sharia-compliant calculation."
    />
    <meta
      name="keywords"
      content="islamic inheritance, inheritance calculator, sharia, faraid, islamic law, heir shares, Quran, Sunnah, asaba, furud, al-awl, miras"
    />
    <meta name="author" content="Islamic Inheritance Calculator" />
    <meta
      name="robots"
      content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
    />

    <!-- SEO: Canonical URL -->
    <link rel="canonical" href="https://–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ–ø–æ–∏—Å–ª–∞–º—É.—Ä—Ñ/en/" />

    <!-- SEO: Hreflang for language versions -->
    <link rel="alternate" hreflang="ru" href="https://–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ–ø–æ–∏—Å–ª–∞–º—É.—Ä—Ñ/" />
    <link
      rel="alternate"
      hreflang="en"
      href="https://–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ–ø–æ–∏—Å–ª–∞–º—É.—Ä—Ñ/en/"
    />
    <link
      rel="alternate"
      hreflang="x-default"
      href="https://–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ–ø–æ–∏—Å–ª–∞–º—É.—Ä—Ñ/"
    />

    <!-- SEO: Open Graph for social media -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ–ø–æ–∏—Å–ª–∞–º—É.—Ä—Ñ/en/" />
    <meta
      property="og:title"
      content="Islamic Inheritance Calculator | Calculate Shares According to Sharia"
    />
    <meta
      property="og:description"
      content="Free online calculator for calculating inheritance shares according to Quran and Sunnah. Accurate calculation of furud, asaba, al-awl."
    />
    <meta
      property="og:image"
      content="https://–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ–ø–æ–∏—Å–ª–∞–º—É.—Ä—Ñ/assets/logo/logo_and_favicon.png"
    />
    <meta property="og:locale" content="en_US" />
    <meta property="og:site_name" content="Islamic Inheritance Calculator" />

    <!-- SEO: Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta
      name="twitter:title"
      content="Islamic Inheritance Calculator | Calculate Shares According to Sharia"
    />
    <meta
      name="twitter:description"
      content="Free online calculator for calculating inheritance shares according to Quran and Sunnah."
    />
    <meta
      name="twitter:image"
      content="https://–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ–ø–æ–∏—Å–ª–∞–º—É.—Ä—Ñ/assets/logo/logo_and_favicon.png"
    />

    <!-- Technical -->
    <meta name="theme-color" content="#1a5f4a" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link
      rel="icon"
      type="image/png"
      href="../assets/logo/logo_and_favicon.png"
    />
    <link rel="apple-touch-icon" href="../assets/logo/logo_and_favicon.png" />

    <!-- SEO: Schema.org structured data -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Islamic Inheritance Calculator",
        "description": "Free online calculator for calculating inheritance shares according to Quran and Sunnah",
        "url": "https://–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ–ø–æ–∏—Å–ª–∞–º—É.—Ä—Ñ/en/",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Web",
        "offers": {
          "@type": "Offer",
          "price": "0",
          "priceCurrency": "USD"
        },
        "inLanguage": "en",
        "isAccessibleForFree": true,
        "browserRequirements": "Requires JavaScript"
      }
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "How to calculate inheritance in Islam?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Inheritance in Islam is calculated according to rules established in the Quran (Surah an-Nisa, verses 11-12, 176). First, debts and bequests (up to 1/3) are paid, then fixed shares (furud) are distributed, and the remainder goes to asaba."
            }
          },
          {
            "@type": "Question",
            "name": "What share of inheritance does a wife receive according to Sharia?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "A wife receives 1/4 of the inheritance if the deceased has no children, and 1/8 if there are children. If there are multiple wives, this share is divided equally among them."
            }
          },
          {
            "@type": "Question",
            "name": "What is al-awl in Islamic inheritance?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Al-awl is the proportional reduction of all heirs' shares when the sum of fixed shares exceeds 100%. This rule was established by Caliph Umar ibn al-Khattab."
            }
          }
        ]
      }
    </script>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Islamic Inheritance Calculator",
        "url": "https://–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ–ø–æ–∏—Å–ª–∞–º—É.—Ä—Ñ/en/",
        "logo": "https://–Ω–∞—Å–ª–µ–¥—Å—Ç–≤–æ–ø–æ–∏—Å–ª–∞–º—É.—Ä—Ñ/assets/logo/logo_and_favicon.png"
      }
    </script>

    <!-- Styles -->
    <link rel="stylesheet" href="../css/styles.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="container">
        <h1 class="header__title">
          <span class="header__text" data-i18n="header.title"
            >Islamic Inheritance Calculator</span
          >
        </h1>
        <p class="header__subtitle" data-i18n="header.subtitle">
          Calculate inheritance shares according to Quran and Sunnah
        </p>

        <!-- Language settings panel -->
        <div class="settings-panel">
          <div class="settings-group" id="language-selector"></div>
        </div>
      </div>
    </header>

    <!-- Modal: Preliminary Obligations (Step 0) -->
    <dialog id="obligations-modal" class="modal" aria-labelledby="modal-title">
      <div class="modal__content">
        <h2 id="modal-title" class="modal__title" data-i18n="obligations.title">
          Preliminary Obligations
        </h2>
        <p class="modal__description" data-i18n="obligations.description">
          Before distributing inheritance, complete the following:
        </p>

        <ul class="obligations-list">
          <li class="obligations-list__item">
            <span class="obligations-list__icon">ü™¶</span>
            <div class="obligations-list__content">
              <strong data-i18n="obligations.burial">Burial expenses</strong>
            </div>
          </li>
          <li class="obligations-list__item">
            <span class="obligations-list__icon">üí∞</span>
            <div class="obligations-list__content">
              <strong data-i18n="obligations.debts">Payment of debts</strong>
            </div>
          </li>
          <li class="obligations-list__item">
            <span class="obligations-list__icon">üìú</span>
            <div class="obligations-list__content">
              <strong data-i18n="obligations.will"
                >Execution of will (wasiyyah)</strong
              >
              <p data-i18n="obligations.willNote">
                No more than 1/3 of estate, not to an heir
              </p>
            </div>
          </li>
          <li class="obligations-list__item">
            <span class="obligations-list__icon">‚öñÔ∏è</span>
            <div class="obligations-list__content">
              <strong data-i18n="obligations.distribution"
                >Distribution of inheritance</strong
              >
            </div>
          </li>
        </ul>

        <div class="modal__confirmation">
          <label class="checkbox">
            <input type="checkbox" id="obligations-checkbox" />
            <span class="checkbox__mark"></span>
            <span class="checkbox__label" data-i18n="obligations.checkbox"
              >I understand the order of actions</span
            >
          </label>
        </div>

        <button
          id="continue-btn"
          class="btn btn--primary"
          disabled
          data-i18n="obligations.continue"
        >
          Proceed to calculator
        </button>
      </div>
    </dialog>

    <!-- Main: Calculator Wizard -->
    <main id="calculator-main" class="main hidden">
      <div class="container">
        <!-- Step 1: Data Entry -->
        <section class="wizard-step active" data-step="input">
          <h2 class="section-title" data-i18n="calculator.title">
            Enter inheritance details
          </h2>

          <!-- Estate Amount -->
          <div class="form-group">
            <label
              for="estate-amount"
              class="form-label"
              data-i18n="calculator.estateAmount"
              >Estate amount</label
            >
            <input
              type="text"
              id="estate-amount"
              class="form-input"
              placeholder="Enter amount"
              data-i18n-placeholder="calculator.estateAmountPlaceholder"
              inputmode="numeric"
            />
            <span class="form-hint" data-i18n="calculator.estateAmountHint"
              >Enter amount after deducting debts and will</span
            >
            <span class="form-error" id="estate-error"></span>
          </div>

          <!-- Spouse -->
          <div class="form-section">
            <h3 class="form-section__title" data-i18n="spouse.title">
              Spouse of the deceased
            </h3>
            <div class="radio-group">
              <label class="radio">
                <input type="radio" name="spouse" value="none" checked />
                <span class="radio__mark"></span>
                <span class="radio__label" data-i18n="spouse.none"
                  >No spouse</span
                >
              </label>
              <label class="radio">
                <input type="radio" name="spouse" value="husband" />
                <span class="radio__mark"></span>
                <span class="radio__label" data-i18n="spouse.husband"
                  >Husband</span
                >
              </label>
              <label class="radio">
                <input type="radio" name="spouse" value="wife" />
                <span class="radio__mark"></span>
                <span class="radio__label" data-i18n="spouse.wife">Wife</span>
              </label>
            </div>
            <span class="form-hint" id="spouse-hint"></span>
            <div id="wife-count-group" class="form-group hidden">
              <label
                for="wife-count"
                class="form-label"
                data-i18n="spouse.wifeCount"
                >Number of wives</label
              >
              <input
                type="number"
                id="wife-count"
                class="form-input form-input--small"
                min="1"
                max="4"
                value="1"
              />
              <span class="form-hint" data-i18n="spouse.wifeCountHint"
                >Share is divided equally among all wives</span
              >
            </div>
          </div>

          <!-- Descendants -->
          <details class="collapsible-section">
            <summary class="collapsible-section__header">
              <span
                class="collapsible-section__title"
                data-i18n="descendants.title"
                >Descendants (descending line)</span
              >
              <span class="collapsible-section__icon">‚ñº</span>
            </summary>
            <div class="collapsible-section__content">
              <div class="form-grid">
                <div class="form-group">
                  <label
                    for="sons"
                    class="form-label"
                    data-i18n="descendants.sons"
                    >Sons</label
                  >
                  <input
                    type="number"
                    id="sons"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                </div>
                <div class="form-group">
                  <label
                    for="daughters"
                    class="form-label"
                    data-i18n="descendants.daughters"
                    >Daughters</label
                  >
                  <input
                    type="number"
                    id="daughters"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                </div>
                <div class="form-group">
                  <label
                    for="grandsons-from-son"
                    class="form-label"
                    data-i18n="descendants.grandsonsFromSon"
                    >Grandsons from son</label
                  >
                  <input
                    type="number"
                    id="grandsons-from-son"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                  <span
                    class="form-hint blocked-hint"
                    id="grandsons-blocked"
                  ></span>
                </div>
                <div class="form-group">
                  <label
                    for="granddaughters-from-son"
                    class="form-label"
                    data-i18n="descendants.granddaughtersFromSon"
                    >Granddaughters from son</label
                  >
                  <input
                    type="number"
                    id="granddaughters-from-son"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                  <span
                    class="form-hint blocked-hint"
                    id="granddaughters-blocked"
                  ></span>
                </div>
              </div>
            </div>
          </details>

          <!-- Ancestors -->
          <details class="collapsible-section">
            <summary class="collapsible-section__header">
              <span
                class="collapsible-section__title"
                data-i18n="ancestors.title"
                >Ancestors (ascending line)</span
              >
              <span class="collapsible-section__icon">‚ñº</span>
            </summary>
            <div class="collapsible-section__content">
              <div class="checkbox-group">
                <label class="checkbox">
                  <input type="checkbox" id="father" />
                  <span class="checkbox__mark"></span>
                  <span class="checkbox__label" data-i18n="ancestors.father"
                    >Father</span
                  >
                </label>
                <label class="checkbox">
                  <input type="checkbox" id="mother" />
                  <span class="checkbox__mark"></span>
                  <span class="checkbox__label" data-i18n="ancestors.mother"
                    >Mother</span
                  >
                </label>
                <label class="checkbox">
                  <input type="checkbox" id="paternal-grandfather" />
                  <span class="checkbox__mark"></span>
                  <span
                    class="checkbox__label"
                    data-i18n="ancestors.paternalGrandfather"
                    >Grandfather (father's father)</span
                  >
                  <span
                    class="form-hint blocked-hint"
                    id="grandfather-blocked"
                  ></span>
                </label>
                <label class="checkbox">
                  <input type="checkbox" id="paternal-grandmother" />
                  <span class="checkbox__mark"></span>
                  <span
                    class="checkbox__label"
                    data-i18n="ancestors.paternalGrandmother"
                    >Grandmother (father's mother)</span
                  >
                  <span
                    class="form-hint blocked-hint"
                    id="paternal-grandmother-blocked"
                  ></span>
                </label>
                <label class="checkbox">
                  <input type="checkbox" id="maternal-grandmother" />
                  <span class="checkbox__mark"></span>
                  <span
                    class="checkbox__label"
                    data-i18n="ancestors.maternalGrandmother"
                    >Grandmother (mother's mother)</span
                  >
                </label>
              </div>
            </div>
          </details>

          <!-- Siblings -->
          <details class="collapsible-section">
            <summary class="collapsible-section__header">
              <span
                class="collapsible-section__title"
                data-i18n="siblings.title"
                >Brothers and sisters (al-ikhwa)</span
              >
              <span class="collapsible-section__icon">‚ñº</span>
            </summary>
            <div class="collapsible-section__content">
              <!-- Full siblings -->
              <h4 class="form-subsection-title" data-i18n="siblings.full">
                Full (germane)
              </h4>
              <div class="form-grid">
                <div class="form-group">
                  <label
                    for="full-brothers"
                    class="form-label"
                    data-i18n="siblings.fullBrothers"
                    >Brothers</label
                  >
                  <input
                    type="number"
                    id="full-brothers"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                  <span
                    class="form-hint blocked-hint"
                    id="full-brothers-blocked"
                  ></span>
                </div>
                <div class="form-group">
                  <label
                    for="full-sisters"
                    class="form-label"
                    data-i18n="siblings.fullSisters"
                    >Sisters</label
                  >
                  <input
                    type="number"
                    id="full-sisters"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                  <span
                    class="form-hint blocked-hint"
                    id="full-sisters-blocked"
                  ></span>
                </div>
              </div>
            </div>
          </details>
        </section>
      </div>
    </main>
  </body>
</html>


              <!-- Paternal siblings -->
              <h4 class="form-subsection-title" data-i18n="siblings.paternal">
                Paternal (consanguine)
              </h4>
              <div class="form-grid">
                <div class="form-group">
                  <label
                    for="paternal-brothers"
                    class="form-label"
                    data-i18n="siblings.paternalBrothers"
                    >Brothers</label
                  >
                  <input
                    type="number"
                    id="paternal-brothers"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                  <span
                    class="form-hint blocked-hint"
                    id="paternal-brothers-blocked"
                  ></span>
                </div>
                <div class="form-group">
                  <label
                    for="paternal-sisters"
                    class="form-label"
                    data-i18n="siblings.paternalSisters"
                    >Sisters</label
                  >
                  <input
                    type="number"
                    id="paternal-sisters"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                  <span
                    class="form-hint blocked-hint"
                    id="paternal-sisters-blocked"
                  ></span>
                </div>
              </div>

              <!-- Maternal siblings -->
              <h4 class="form-subsection-title" data-i18n="siblings.maternal">
                Maternal (uterine)
              </h4>
              <div class="form-grid">
                <div class="form-group">
                  <label
                    for="maternal-brothers"
                    class="form-label"
                    data-i18n="siblings.maternalBrothers"
                    >Brothers</label
                  >
                  <input
                    type="number"
                    id="maternal-brothers"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                  <p
                    class="form-hint blocked-hint"
                    id="maternal-brothers-blocked"
                  ></p>
                </div>
                <div class="form-group">
                  <label
                    for="maternal-sisters"
                    class="form-label"
                    data-i18n="siblings.maternalSisters"
                    >Sisters</label
                  >
                  <input
                    type="number"
                    id="maternal-sisters"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                  <p
                    class="form-hint blocked-hint"
                    id="maternal-sisters-blocked"
                  ></p>
                </div>
              </div>

              <!-- Distant male-line heirs -->
              <h4 class="form-subsection-title" data-i18n="siblings.distant">
                Distant male-line heirs (asaba)
              </h4>
              <div class="form-grid">
                <div class="form-group">
                  <label
                    for="nephews-full-brothers"
                    class="form-label"
                    data-i18n="siblings.nephewsFullBrothers"
                    >Sons of full brothers (nephews)</label
                  >
                  <input
                    type="number"
                    id="nephews-full-brothers"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                </div>
                <div class="form-group">
                  <label
                    for="nephews-paternal-brothers"
                    class="form-label"
                    data-i18n="siblings.nephewsPaternalBrothers"
                    >Sons of paternal brothers (nephews)</label
                  >
                  <input
                    type="number"
                    id="nephews-paternal-brothers"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                </div>
                <div class="form-group">
                  <label
                    for="uncles-full"
                    class="form-label"
                    data-i18n="siblings.unclesFull"
                    >Uncles (father's full brothers)</label
                  >
                  <input
                    type="number"
                    id="uncles-full"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                </div>
                <div class="form-group">
                  <label
                    for="uncles-paternal"
                    class="form-label"
                    data-i18n="siblings.unclesPaternal"
                    >Uncles (father's paternal brothers)</label
                  >
                  <input
                    type="number"
                    id="uncles-paternal"
                    class="form-input"
                    min="0"
                    value="0"
                  />
                </div>
              </div>
              <p class="form-hint blocked-hint" id="distant-asaba-blocked"></p>
            </div>
          </details>

          <div class="form-actions">
            <button
              id="calculate-btn"
              class="btn btn--primary btn--large"
              data-i18n="calculator.calculate"
            >
              Calculate inheritance
            </button>
          </div>
        </section>
      </div>
    </main>

    <!-- Section: Results -->
    <section id="results-section" class="results-section hidden">
      <div class="container">
        <h2 class="section-title" data-i18n="results.title">
          Calculation Results
        </h2>

        <!-- Special case notifications -->
        <div id="special-notices" class="notices"></div>

        <!-- Results table -->
        <div class="results-table-wrapper">
          <table class="results-table" id="results-table">
            <thead>
              <tr>
                <th data-i18n="results.heir">Heir</th>
                <th data-i18n="results.relation">Relation</th>
                <th data-i18n="results.share">Share</th>
                <th data-i18n="results.percent">%</th>
                <th data-i18n="results.amount">Amount</th>
                <th data-i18n="results.basis">Basis</th>
              </tr>
            </thead>
            <tbody id="results-body">
              <!-- Results will be added dynamically -->
            </tbody>
            <tfoot>
              <tr class="results-total">
                <td colspan="3">
                  <strong data-i18n="results.total">Total</strong>
                </td>
                <td id="total-percentage">100%</td>
                <td id="total-amount">0</td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>

        <!-- Mobile results (cards) -->
        <div class="results-cards" id="results-cards">
          <!-- Cards will be added dynamically -->
        </div>

        <div id="remainder-panel" class="notice notice--info hidden">
          <span class="notice__icon">üí†</span>
          <div>
            <strong data-i18n="results.remainder">Remaining estate</strong>
            <div class="remainder-summary">
              <span id="remainder-percentage">0%</span>
              ¬∑
              <span id="remainder-amount">0</span>
              ‚Üí <span data-i18n="results.remainderTo">Treasury/Charity</span>
            </div>
          </div>
        </div>

        <div class="results-actions">
          <button
            id="print-btn"
            class="btn btn--secondary"
            data-i18n="results.print"
          >
            üñ®Ô∏è Print / Save as PDF
          </button>
          <button
            id="recalculate-btn"
            class="btn btn--outline"
            data-i18n="results.recalculate"
          >
            ‚Ü©Ô∏è New calculation
          </button>
        </div>
      </div>
    </section>

    <!-- Section: Glossary -->
    <section
      id="glossary-section"
      class="glossary-section"
      itemscope
      itemtype="https://schema.org/DefinedTermSet"
    >
      <div class="container">
        <h2 class="section-title" data-i18n="glossary.title">
          Glossary of Islamic Inheritance Law Terms
        </h2>
        <div class="glossary-grid" id="glossary-grid">
          <!-- Terms are generated dynamically from i18n -->
        </div>
      </div>
    </section>

    <!-- Section: FAQ -->
    <section
      id="faq-section"
      class="faq-section"
      itemscope
      itemtype="https://schema.org/FAQPage"
    >
      <div class="container">
        <h2 class="section-title" data-i18n="faq.title">
          Frequently Asked Questions About Islamic Inheritance
        </h2>
        <div class="faq-accordion" id="faq-accordion">
          <!-- FAQ is generated dynamically from i18n -->
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="disclaimer">
          <h3 class="disclaimer__title">
            ‚ö†Ô∏è <span data-i18n="footer.warning">Important Notice</span>
          </h3>
          <p class="disclaimer__text" data-i18n="footer.disclaimer1">
            This calculator is for educational purposes only and is intended to help understand the principles of Islamic inheritance law (ilm al-faraid).
          </p>
          <p class="disclaimer__text" data-i18n="footer.disclaimer2">
            For issuing fatwas and resolving specific inheritance matters, please consult a qualified scholar (alim) or mufti.
          </p>
          <p class="disclaimer__text">
            <strong data-i18n="footer.attention">Attention:</strong>
            <span data-i18n="footer.disclaimer3"
              >The calculation results are not an official ruling and cannot be used as a legal document.</span
            >
          </p>
        </div>
        <div class="footer__copyright">
          <p data-i18n="footer.copyright">
            ¬© 2026 Islamic Inheritance Calculator
          </p>
        </div>
      </div>
    </footer>
              >–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –∑–∞–∫–ª—é—á–µ–Ω–∏–µ–º –∏ –Ω–µ –º–æ–≥—É—Ç
              –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.</span
            >
          </p>
        </div>
        <div class="footer__copyright">
          <p data-i18n="footer.copyright">
            ¬© 2026 –ò—Å–ª–∞–º—Å–∫–∏–π –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ù–∞—Å–ª–µ–¥—Å—Ç–≤–∞
          </p>
        </div>
      </div>
    </footer>

    <script>
      // ========================================
      // –•–µ–ª–ø–µ—Ä—ã –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      // ========================================

      /**
       * –ü–æ–ª—É—á–∞–µ—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
       */
      function getHeirName(type, count = 1) {
        const names = {
          wife:
            count > 1
              ? `${I18n.t("heirs.wives")} (${count})`
              : I18n.t("heirs.wife"),
          husband: I18n.t("heirs.husband"),
          son:
            count > 1
              ? `${I18n.t("heirs.sons")} (${count})`
              : I18n.t("heirs.son"),
          daughter:
            count > 1
              ? `${I18n.t("heirs.daughters")} (${count})`
              : I18n.t("heirs.daughter"),
          father: I18n.t("heirs.father"),
          mother: I18n.t("heirs.mother"),
          grandfather: I18n.t("ancestors.paternalGrandfather"),
          paternalGrandmother: I18n.t("ancestors.paternalGrandmother"),
          maternalGrandmother: I18n.t("ancestors.maternalGrandmother"),
          grandmother: I18n.t("heirs.grandmother"),
          grandmothers: I18n.t("heirs.grandmothers"),
          grandsonsFromSon:
            count > 1
              ? `${I18n.t("heirs.grandsonsFromSon")} (${count})`
              : I18n.t("heirs.grandsonFromSon"),
          granddaughtersFromSon:
            count > 1
              ? `${I18n.t("heirs.granddaughtersFromSon")} (${count})`
              : I18n.t("heirs.granddaughterFromSon"),
          fullBrother:
            count > 1
              ? `${I18n.t("heirs.fullBrothers")} (${count})`
              : I18n.t("heirs.fullBrother"),
          fullSister:
            count > 1
              ? `${I18n.t("heirs.fullSisters")} (${count})`
              : I18n.t("heirs.fullSister"),
          paternalBrother:
            count > 1
              ? `${I18n.t("heirs.paternalBrothers")} (${count})`
              : I18n.t("heirs.paternalBrother"),
          paternalSister:
            count > 1
              ? `${I18n.t("heirs.paternalSisters")} (${count})`
              : I18n.t("heirs.paternalSister"),
          maternalBrother:
            count > 1
              ? `${I18n.t("heirs.maternalBrothers")} (${count})`
              : I18n.t("heirs.maternalBrother"),
          maternalSister:
            count > 1
              ? `${I18n.t("heirs.maternalSisters")} (${count})`
              : I18n.t("heirs.maternalSister"),
        };
        return names[type] || type;
      }

      /**
       * –ü–æ–ª—É—á–∞–µ—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
       */
      function getHeirRelation(type) {
        const relations = {
          spouse: I18n.t("relations.spouseOfDeceased"),
          spouseM: I18n.t("relations.spouseOfDeceasedM"),
          child: I18n.t("relations.childOfDeceased"),
          parent: I18n.t("relations.parentOfDeceased"),
          sibling: I18n.t("relations.siblingOfDeceased"),
          grandchild: I18n.t("relations.grandchildOfDeceased"),
        };
        return relations[type] || type;
      }

      /**
       * –ü–æ–ª—É—á–∞–µ—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–∞–ª–∏–ª—å (–æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ)
       */
      function getDalil(type) {
        const dalils = {
          quran411: I18n.t("dalil.quran411"),
          quran412: I18n.t("dalil.quran412"),
          quran4176: I18n.t("dalil.quran4176"),
          sunnah: I18n.t("dalil.sunnah"),
        };
        return dalils[type] || type;
      }

      // ========================================
      // Fraction Class - –†–∞–±–æ—Ç–∞ —Å –¥—Ä–æ–±—è–º–∏
      // ========================================

      /**
       * –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥—Ä–æ–±—è–º–∏
       * –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –¥–æ–ª—è–º–∏ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞
       */
      class Fraction {
        /**
         * –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –¥—Ä–æ–±—å
         * @param {number} numerator - —á–∏—Å–ª–∏—Ç–µ–ª—å
         * @param {number} denominator - –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å 0)
         */
        constructor(numerator, denominator = 1) {
          if (denominator === 0) {
            throw new Error("–ó–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–≤–µ–Ω –Ω—É–ª—é");
          }

          // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∑–Ω–∞–∫: –∑–Ω–∞–∫ –≤—Å–µ–≥–¥–∞ –≤ —á–∏—Å–ª–∏—Ç–µ–ª–µ
          if (denominator < 0) {
            numerator = -numerator;
            denominator = -denominator;
          }

          this.num = numerator;
          this.den = denominator;
        }

        /**
         * –í—ã—á–∏—Å–ª—è–µ—Ç –Ω–∞–∏–±–æ–ª—å—à–∏–π –æ–±—â–∏–π –¥–µ–ª–∏—Ç–µ–ª—å (–ù–û–î) –¥–≤—É—Ö —á–∏—Å–µ–ª
         * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–ª–≥–æ—Ä–∏—Ç–º –ï–≤–∫–ª–∏–¥–∞
         * @param {number} a - –ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ
         * @param {number} b - –≤—Ç–æ—Ä–æ–µ —á–∏—Å–ª–æ
         * @returns {number} - –ù–û–î
         */
        static gcd(a, b) {
          a = Math.abs(a);
          b = Math.abs(b);
          while (b !== 0) {
            const temp = b;
            b = a % b;
            a = temp;
          }
          return a;
        }

        /**
         * –í—ã—á–∏—Å–ª—è–µ—Ç –Ω–∞–∏–º–µ–Ω—å—à–µ–µ –æ–±—â–µ–µ –∫—Ä–∞—Ç–Ω–æ–µ (–ù–û–ö) –¥–≤—É—Ö —á–∏—Å–µ–ª
         * @param {number} a - –ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ
         * @param {number} b - –≤—Ç–æ—Ä–æ–µ —á–∏—Å–ª–æ
         * @returns {number} - –ù–û–ö
         */
        static lcm(a, b) {
          return Math.abs(a * b) / Fraction.gcd(a, b);
        }

        /**
         * –£–ø—Ä–æ—â–∞–µ—Ç –¥—Ä–æ–±—å, –¥–µ–ª—è —á–∏—Å–ª–∏—Ç–µ–ª—å –∏ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å –Ω–∞ –∏—Ö –ù–û–î
         * @returns {Fraction} - –Ω–æ–≤–∞—è —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –¥—Ä–æ–±—å
         */
        simplify() {
          if (this.num === 0) {
            return new Fraction(0, 1);
          }
          const gcd = Fraction.gcd(this.num, this.den);
          return new Fraction(this.num / gcd, this.den / gcd);
        }

        /**
         * –°–∫–ª–∞–¥—ã–≤–∞–µ—Ç –¥–≤–µ –¥—Ä–æ–±–∏
         * @param {Fraction} other - –¥—Ä—É–≥–∞—è –¥—Ä–æ–±—å
         * @returns {Fraction} - —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–ª–æ–∂–µ–Ω–∏—è (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)
         */
        add(other) {
          if (!(other instanceof Fraction)) {
            other = new Fraction(other);
          }
          // a/b + c/d = (a*d + c*b) / (b*d)
          const newNum = this.num * other.den + other.num * this.den;
          const newDen = this.den * other.den;
          return new Fraction(newNum, newDen).simplify();
        }

        /**
         * –í—ã—á–∏—Ç–∞–µ—Ç –¥—Ä–æ–±—å –∏–∑ —Ç–µ–∫—É—â–µ–π
         * @param {Fraction} other - –≤—ã—á–∏—Ç–∞–µ–º–∞—è –¥—Ä–æ–±—å
         * @returns {Fraction} - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—á–∏—Ç–∞–Ω–∏—è (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)
         */
        subtract(other) {
          if (!(other instanceof Fraction)) {
            other = new Fraction(other);
          }
          // a/b - c/d = (a*d - c*b) / (b*d)
          const newNum = this.num * other.den - other.num * this.den;
          const newDen = this.den * other.den;
          return new Fraction(newNum, newDen).simplify();
        }

        /**
         * –£–º–Ω–æ–∂–∞–µ—Ç –¥–≤–µ –¥—Ä–æ–±–∏
         * @param {Fraction} other - –¥—Ä—É–≥–∞—è –¥—Ä–æ–±—å
         * @returns {Fraction} - —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–º–Ω–æ–∂–µ–Ω–∏—è (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)
         */
        multiply(other) {
          if (!(other instanceof Fraction)) {
            other = new Fraction(other);
          }
          // a/b * c/d = (a*c) / (b*d)
          return new Fraction(
            this.num * other.num,
            this.den * other.den
          ).simplify();
        }

        /**
         * –î–µ–ª–∏—Ç —Ç–µ–∫—É—â—É—é –¥—Ä–æ–±—å –Ω–∞ –¥—Ä—É–≥—É—é
         * @param {Fraction} other - –¥–µ–ª–∏—Ç–µ–ª—å
         * @returns {Fraction} - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ–ª–µ–Ω–∏—è (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–π)
         */
        divide(other) {
          if (!(other instanceof Fraction)) {
            other = new Fraction(other);
          }
          if (other.num === 0) {
            throw new Error("–î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å");
          }
          // a/b √∑ c/d = (a*d) / (b*c)
          return new Fraction(
            this.num * other.den,
            this.den * other.num
          ).simplify();
        }

        /**
         * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥—Ä–æ–±—å –≤ –¥–µ—Å—è—Ç–∏—á–Ω–æ–µ —á–∏—Å–ª–æ
         * @returns {number} - –¥–µ—Å—è—Ç–∏—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
         */
        toDecimal() {
          return this.num / this.den;
        }

        /**
         * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥—Ä–æ–±—å –≤ —Å—Ç—Ä–æ–∫—É –≤–∏–¥–∞ "—á–∏—Å–ª–∏—Ç–µ–ª—å/–∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å"
         * @returns {string} - —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
         */
        toString() {
          if (this.den === 1) {
            return String(this.num);
          }
          return `${this.num}/${this.den}`;
        }

        /**
         * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ –¥–≤—É—Ö –¥—Ä–æ–±–µ–π
         * @param {Fraction} other - –¥—Ä—É–≥–∞—è –¥—Ä–æ–±—å
         * @returns {boolean} - true –µ—Å–ª–∏ –¥—Ä–æ–±–∏ —Ä–∞–≤–Ω—ã
         */
        equals(other) {
          if (!(other instanceof Fraction)) {
            other = new Fraction(other);
          }
          // –£–ø—Ä–æ—â–∞–µ–º –æ–±–µ –¥—Ä–æ–±–∏ –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º
          const simplified1 = this.simplify();
          const simplified2 = other.simplify();
          return (
            simplified1.num === simplified2.num &&
            simplified1.den === simplified2.den
          );
        }

        /**
         * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –±–æ–ª—å—à–µ –ª–∏ —Ç–µ–∫—É—â–∞—è –¥—Ä–æ–±—å –¥—Ä—É–≥–æ–π
         * @param {Fraction} other - –¥—Ä—É–≥–∞—è –¥—Ä–æ–±—å
         * @returns {boolean}
         */
        greaterThan(other) {
          if (!(other instanceof Fraction)) {
            other = new Fraction(other);
          }
          return this.num * other.den > other.num * this.den;
        }

        /**
         * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–µ–Ω—å—à–µ –ª–∏ —Ç–µ–∫—É—â–∞—è –¥—Ä–æ–±—å –¥—Ä—É–≥–æ–π
         * @param {Fraction} other - –¥—Ä—É–≥–∞—è –¥—Ä–æ–±—å
         * @returns {boolean}
         */
        lessThan(other) {
          if (!(other instanceof Fraction)) {
            other = new Fraction(other);
          }
          return this.num * other.den < other.num * this.den;
        }

        /**
         * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥—Ä–æ–±—å –Ω—É–ª–µ–º
         * @returns {boolean}
         */
        isZero() {
          return this.num === 0;
        }

        /**
         * –°–æ–∑–¥–∞–µ—Ç –∫–æ–ø–∏—é –¥—Ä–æ–±–∏
         * @returns {Fraction}
         */
        clone() {
          return new Fraction(this.num, this.den);
        }

        /**
         * –°–æ–∑–¥–∞–µ—Ç –¥—Ä–æ–±—å –∏–∑ –¥–µ—Å—è—Ç–∏—á–Ω–æ–≥–æ —á–∏—Å–ª–∞ (–ø—Ä–∏–±–ª–∏–∂–µ–Ω–Ω–æ)
         * @param {number} decimal - –¥–µ—Å—è—Ç–∏—á–Ω–æ–µ —á–∏—Å–ª–æ
         * @param {number} precision - —Ç–æ—á–Ω–æ—Å—Ç—å (–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª—å)
         * @returns {Fraction}
         */
        static fromDecimal(decimal, precision = 1000000) {
          if (decimal === 0) return new Fraction(0, 1);

          const sign = decimal < 0 ? -1 : 1;
          decimal = Math.abs(decimal);

          // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º —Ü–µ–ø–Ω—ã—Ö –¥—Ä–æ–±–µ–π –¥–ª—è –ª—É—á—à–µ–≥–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è
          let bestNum = 1;
          let bestDen = 1;
          let bestError = Math.abs(decimal - bestNum / bestDen);

          for (let den = 1; den <= precision; den++) {
            const num = Math.round(decimal * den);
            const error = Math.abs(decimal - num / den);
            if (error < bestError) {
              bestError = error;
              bestNum = num;
              bestDen = den;
              if (error === 0) break;
            }
          }

          return new Fraction(sign * bestNum, bestDen).simplify();
        }
      }

      // ========================================
      // Blocking Rules System (–•–∏–¥–∂–±)
      // ========================================

      /**
       * –ü—Ä–∞–≤–∏–ª–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
       * –ö–∞–∂–¥–æ–µ –ø—Ä–∞–≤–∏–ª–æ - —Ñ—É–Ω–∫—Ü–∏—è, –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è boolean
       * Requirements: 9.1, 9.2, 9.3, 9.4, 9.5
       */
      const BlockingRules = {
        /**
         * –î–µ–¥ (–æ—Ç–µ—Ü –æ—Ç—Ü–∞) –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –æ—Ç—Ü–æ–º
         * Requirements: 9.1
         */
        paternalGrandfather: (heirs) => heirs.father === true,

        /**
         * –ë–∞–±—É—à–∫–∞ –ø–æ –æ—Ç—Ü—É –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –º–∞—Ç–µ—Ä—å—é
         * Requirements: 9.5
         */
        paternalGrandmother: (heirs) => heirs.mother === true,

        /**
         * –í–Ω—É–∫–∏ –æ—Ç —Å—ã–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å—ã–Ω–æ–≤—å—è–º–∏
         * Requirements: 9.2, 4.2
         */
        grandsonsFromSon: (heirs) => heirs.sons > 0,

        /**
         * –í–Ω—É—á–∫–∏ –æ—Ç —Å—ã–Ω–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å—ã–Ω–æ–≤—å—è–º–∏
         * Requirements: 9.2, 4.2
         */
        granddaughtersFromSon: (heirs) => heirs.sons > 0,

        /**
         * –†–æ–¥–Ω—ã–µ –±—Ä–∞—Ç—å—è –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –æ—Ç—Ü–æ–º, –¥–µ–¥–æ–º, —Å—ã–Ω–æ–º –∏–ª–∏ –≤–Ω—É–∫–æ–º –æ—Ç —Å—ã–Ω–∞
         * Requirements: 9.3, 6.3
         */
        fullBrothers: (heirs) =>
          heirs.father === true ||
          heirs.paternalGrandfather === true ||
          heirs.sons > 0 ||
          heirs.grandsonsFromSon > 0,

        /**
         * –†–æ–¥–Ω—ã–µ —Å–µ—Å—Ç—Ä—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –æ—Ç—Ü–æ–º, –¥–µ–¥–æ–º, —Å—ã–Ω–æ–º –∏–ª–∏ –≤–Ω—É–∫–æ–º –æ—Ç —Å—ã–Ω–∞
         * Requirements: 9.3, 6.3
         */
        fullSisters: (heirs) =>
          heirs.father === true ||
          heirs.paternalGrandfather === true ||
          heirs.sons > 0 ||
          heirs.grandsonsFromSon > 0,

        /**
         * –ï–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–µ –±—Ä–∞—Ç—å—è (–ø–æ –æ—Ç—Ü—É) –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è:
         * - –æ—Ç—Ü–æ–º, –¥–µ–¥–æ–º, —Å—ã–Ω–æ–º –∏–ª–∏ –≤–Ω—É–∫–æ–º –æ—Ç —Å—ã–Ω–∞ (–∫–∞–∫ –≤—Å–µ –±—Ä–∞—Ç—å—è)
         * - —Ä–æ–¥–Ω—ã–º–∏ –±—Ä–∞—Ç—å—è–º–∏
         * Requirements: 9.3, 9.4, 6.3, 6.4
         */
        paternalBrothers: (heirs) =>
          heirs.father === true ||
          heirs.paternalGrandfather === true ||
          heirs.sons > 0 ||
          heirs.grandsonsFromSon > 0 ||
          heirs.fullBrothers > 0,

        /**
         * –ï–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–µ —Å–µ—Å—Ç—Ä—ã (–ø–æ –æ—Ç—Ü—É) –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è:
         * - –æ—Ç—Ü–æ–º, –¥–µ–¥–æ–º, —Å—ã–Ω–æ–º –∏–ª–∏ –≤–Ω—É–∫–æ–º –æ—Ç —Å—ã–Ω–∞ (–∫–∞–∫ –≤—Å–µ –±—Ä–∞—Ç—å—è/—Å–µ—Å—Ç—Ä—ã)
         * - —Ä–æ–¥–Ω—ã–º–∏ –±—Ä–∞—Ç—å—è–º–∏
         * Requirements: 9.3, 9.4, 6.3, 6.4
         */
        paternalSisters: (heirs) =>
          heirs.father === true ||
          heirs.paternalGrandfather === true ||
          heirs.sons > 0 ||
          heirs.grandsonsFromSon > 0 ||
          heirs.fullBrothers > 0,

        /**
         * –ï–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω—ã–µ –±—Ä–∞—Ç—å—è –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –æ—Ç—Ü–æ–º, –¥–µ–¥–æ–º –∏–ª–∏ –ª—é–±—ã–º–∏ –ø–æ—Ç–æ–º–∫–∞–º–∏
         * Requirements: 9.3, 9.6
         */
        maternalBrothers: (heirs) =>
          heirs.father === true ||
          heirs.paternalGrandfather === true ||
          heirs.sons > 0 ||
          heirs.daughters > 0 ||
          heirs.grandsonsFromSon > 0 ||
          heirs.granddaughtersFromSon > 0,

        /**
         * –ï–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω—ã–µ —Å–µ—Å—Ç—Ä—ã –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –æ—Ç—Ü–æ–º, –¥–µ–¥–æ–º –∏–ª–∏ –ª—é–±—ã–º–∏ –ø–æ—Ç–æ–º–∫–∞–º–∏
         * Requirements: 9.3, 9.6
         */
        maternalSisters: (heirs) =>
          heirs.father === true ||
          heirs.paternalGrandfather === true ||
          heirs.sons > 0 ||
          heirs.daughters > 0 ||
          heirs.grandsonsFromSon > 0 ||
          heirs.granddaughtersFromSon > 0,
      };

      /**
       * –ü—Ä–∏—á–∏–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
       * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª—é—á–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
       */
      const BlockingReasons = {
        paternalGrandfather: {
          father: "blocking.byFather",
        },
        paternalGrandmother: {
          mother: "blocking.byMother",
        },
        grandsonsFromSon: {
          sons: "blocking.bySon",
        },
        granddaughtersFromSon: {
          sons: "blocking.bySon",
        },
        fullBrothers: {
          father: "blocking.byFather",
          paternalGrandfather: "blocking.byGrandfather",
          sons: "blocking.bySon",
          grandsonsFromSon: "blocking.byGrandson",
        },
        fullSisters: {
          father: "blocking.byFather",
          paternalGrandfather: "blocking.byGrandfather",
          sons: "blocking.bySon",
          grandsonsFromSon: "blocking.byGrandson",
        },
        paternalBrothers: {
          father: "blocking.byFather",
          paternalGrandfather: "blocking.byGrandfather",
          sons: "blocking.bySon",
          grandsonsFromSon: "blocking.byGrandson",
          fullBrothers: "blocking.byFullBrother",
        },
        paternalSisters: {
          father: "blocking.byFather",
          paternalGrandfather: "blocking.byGrandfather",
          sons: "blocking.bySon",
          grandsonsFromSon: "blocking.byGrandson",
          fullBrothers: "blocking.byFullBrother",
        },
        maternalBrothers: {
          father: "blocking.byFather",
          paternalGrandfather: "blocking.byGrandfather",
          sons: "blocking.byDescendants",
          daughters: "blocking.byDescendants",
          grandsonsFromSon: "blocking.byDescendants",
          granddaughtersFromSon: "blocking.byDescendants",
        },
        maternalSisters: {
          father: "blocking.byFather",
          paternalGrandfather: "blocking.byGrandfather",
          sons: "blocking.byDescendants",
          daughters: "blocking.byDescendants",
          grandsonsFromSon: "blocking.byDescendants",
          granddaughtersFromSon: "blocking.byDescendants",
        },
      };

      /**
       * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
       * @param {string} heirType - —Ç–∏–ø –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞ (–∫–ª—é—á –∏–∑ BlockingRules)
       * @param {object} heirs - –æ–±—ä–µ–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @returns {object} - { blocked: boolean, reason: string | null }
       */
      function checkBlocking(heirType, heirs) {
        const rule = BlockingRules[heirType];

        // –ï—Å–ª–∏ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –æ–Ω –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è
        if (!rule) {
          return { blocked: false, reason: null };
        }

        const blocked = rule(heirs);

        if (!blocked) {
          return { blocked: false, reason: null };
        }

        const reason = getBlockingReason(heirType, heirs);
        return { blocked: true, reason };
      }

      /**
       * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤ (–¥–µ–¥, –±–∞–±—É—à–∫–∞, –≤–Ω—É–∫–∏)
       * @param {string} heirType - —Ç–∏–ø –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
       * @param {object} heirs - –æ–±—ä–µ–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @param {object} reasons - –æ–±—ä–µ–∫—Ç —Å –ø—Ä–∏—á–∏–Ω–∞–º–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
       * @returns {string | null} - –ø—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ null
       */
      function checkSimpleBlocking(heirType, heirs, reasons) {
        const simpleBlockingMap = {
          paternalGrandfather: () =>
            heirs.father === true ? reasons.father : null,
          paternalGrandmother: () =>
            heirs.mother === true ? reasons.mother : null,
          grandsonsFromSon: () => (heirs.sons > 0 ? reasons.sons : null),
          granddaughtersFromSon: () => (heirs.sons > 0 ? reasons.sons : null),
        };

        const checkFunction = simpleBlockingMap[heirType];
        return checkFunction ? checkFunction() : null;
      }

      /**
       * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–ª—è —Ä–æ–¥–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤/—Å–µ—Å—Ç–µ—Ä
       * @param {object} heirs - –æ–±—ä–µ–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @param {object} reasons - –æ–±—ä–µ–∫—Ç —Å –ø—Ä–∏—á–∏–Ω–∞–º–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
       * @returns {string | null} - –ø—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ null
       */
      function checkFullSiblingsBlocking(heirs, reasons) {
        if (heirs.father === true) return reasons.father;
        if (heirs.sons > 0) return reasons.sons;
        if (heirs.grandsonsFromSon > 0) return reasons.grandsonsFromSon;
        return null;
      }

      /**
       * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–ª—è –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤/—Å–µ—Å—Ç–µ—Ä
       * @param {object} heirs - –æ–±—ä–µ–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @param {object} reasons - –æ–±—ä–µ–∫—Ç —Å –ø—Ä–∏—á–∏–Ω–∞–º–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
       * @returns {string | null} - –ø—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ null
       */
      function checkPaternalSiblingsBlocking(heirs, reasons) {
        if (heirs.father === true) return reasons.father;
        if (heirs.sons > 0) return reasons.sons;
        if (heirs.grandsonsFromSon > 0) return reasons.grandsonsFromSon;
        if (heirs.fullBrothers > 0) return reasons.fullBrothers;
        return null;
      }

      /**
       * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–ª—è –µ–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤/—Å–µ—Å—Ç–µ—Ä
       * @param {object} heirs - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @param {object} reasons - –ø—Ä–∏—á–∏–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
       * @returns {string | null}
       */
      function checkMaternalSiblingsBlocking(heirs, reasons) {
        if (heirs.father === true) return reasons.father;
        if (heirs.sons > 0) return reasons.sons;
        if (heirs.daughters > 0) return reasons.daughters;
        if (heirs.grandsonsFromSon > 0) return reasons.grandsonsFromSon;
        if (heirs.granddaughtersFromSon > 0)
          return reasons.granddaughtersFromSon;
        return null;
      }

      /**
       * –ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
       * @param {string} heirType - —Ç–∏–ø –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
       * @param {object} heirs - –æ–±—ä–µ–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @returns {string | null} - –ø—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏–ª–∏ null
       */
      function getBlockingReason(heirType, heirs) {
        const reasons = BlockingReasons[heirType];
        if (!reasons) return null;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ—Å—Ç—ã–µ —Å–ª—É—á–∞–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        const simpleReason = checkSimpleBlocking(heirType, heirs, reasons);
        if (simpleReason) return simpleReason;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–¥–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤/—Å–µ—Å—Ç–µ—Ä
        if (heirType === "fullBrothers" || heirType === "fullSisters") {
          return checkFullSiblingsBlocking(heirs, reasons);
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤/—Å–µ—Å—Ç–µ—Ä
        if (heirType === "paternalBrothers" || heirType === "paternalSisters") {
          return checkPaternalSiblingsBlocking(heirs, reasons);
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤/—Å–µ—Å—Ç–µ—Ä
        if (heirType === "maternalBrothers" || heirType === "maternalSisters") {
          return checkMaternalSiblingsBlocking(heirs, reasons);
        }

        return null;
      }

      /**
       * –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @param {object} heirs - –æ–±—ä–µ–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @returns {object} - –æ–±—ä–µ–∫—Ç —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
       */
      function getAllBlockings(heirs) {
        const blockings = {};

        for (const heirType of Object.keys(BlockingRules)) {
          blockings[heirType] = checkBlocking(heirType, heirs);
        }

        return blockings;
      }

      // ========================================
      // Inheritance Calculation Helpers
      // ========================================

      /**
       * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –¥–µ—Ç–µ–π –∏–ª–∏ –≤–Ω—É–∫–æ–≤ –æ—Ç —Å—ã–Ω–∞
       * @param {object} heirs - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @returns {boolean}
       */
      function hasChildren(heirs) {
        return (
          heirs.sons > 0 ||
          heirs.daughters > 0 ||
          heirs.grandsonsFromSon > 0 ||
          heirs.granddaughtersFromSon > 0
        );
      }

      /**
       * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å—ã–Ω–æ–≤–µ–π –∏–ª–∏ –≤–Ω—É–∫–æ–≤ –æ—Ç —Å—ã–Ω–∞ (–º—É–∂—Å–∫–∏—Ö –ø–æ—Ç–æ–º–∫–æ–≤)
       * @param {object} heirs - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @returns {boolean}
       */
      function hasMaleDescendants(heirs) {
        return heirs.sons > 0 || heirs.grandsonsFromSon > 0;
      }

      /**
       * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –±—Ä–∞—Ç—å–µ–≤/—Å–µ—Å—Ç–µ—Ä (2 –∏ –±–æ–ª–µ–µ)
       * @param {object} heirs - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @returns {boolean}
       */
      function hasMultipleSiblings(heirs) {
        const totalSiblings =
          (heirs.fullBrothers || 0) +
          (heirs.fullSisters || 0) +
          (heirs.paternalBrothers || 0) +
          (heirs.paternalSisters || 0) +
          (heirs.maternalBrothers || 0) +
          (heirs.maternalSisters || 0);
        return totalSiblings >= 2;
      }

      /**
       * –¢–∏–ø—ã –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤ —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ —Ä–∞—Å—á–µ—Ç–∞ –¥–æ–ª–µ–π
       */
      const HeirTypes = {
        HUSBAND: {
          id: "husband",
          nameRu: "–ú—É–∂",
          nameAr: "ÿßŸÑÿ≤Ÿàÿ¨",
          category: "spouse",
          gender: "male",
          isAsaba: false,
          getShare: (heirs) =>
            hasChildren(heirs) ? new Fraction(1, 4) : new Fraction(1, 2),
          dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:12',
        },
        WIFE: {
          id: "wife",
          nameRu: "–ñ–µ–Ω–∞",
          nameAr: "ÿßŸÑÿ≤Ÿàÿ¨ÿ©",
          category: "spouse",
          gender: "female",
          isAsaba: false,
          getShare: (heirs) =>
            hasChildren(heirs) ? new Fraction(1, 8) : new Fraction(1, 4),
          dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:12',
        },
        SON: {
          id: "son",
          nameRu: "–°—ã–Ω",
          nameAr: "ÿßŸÑÿßÿ®ŸÜ",
          category: "descendant",
          gender: "male",
          isAsaba: true,
          getShare: () => null,
          dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:11',
        },
        DAUGHTER: {
          id: "daughter",
          nameRu: "–î–æ—á—å",
          nameAr: "ÿßŸÑÿ®ŸÜÿ™",
          category: "descendant",
          gender: "female",
          isAsaba: false,
          getShare: (heirs) => {
            if (heirs.sons > 0) return null;
            if (heirs.daughters === 1) return new Fraction(1, 2);
            return new Fraction(2, 3);
          },
          dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:11',
        },
        GRANDSON_FROM_SON: {
          id: "grandsonsFromSon",
          nameRu: "–í–Ω—É–∫ –æ—Ç —Å—ã–Ω–∞",
          nameAr: "ÿßÿ®ŸÜ ÿßŸÑÿßÿ®ŸÜ",
          category: "descendant",
          gender: "male",
          isAsaba: true,
          getShare: () => null,
          dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:11 (–ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å —Å—ã–Ω–æ–º)',
        },
        GRANDDAUGHTER_FROM_SON: {
          id: "granddaughtersFromSon",
          nameRu: "–í–Ω—É—á–∫–∞ –æ—Ç —Å—ã–Ω–∞",
          nameAr: "ÿ®ŸÜÿ™ ÿßŸÑÿßÿ®ŸÜ",
          category: "descendant",
          gender: "female",
          isAsaba: false,
          getShare: (heirs) => {
            if (heirs.grandsonsFromSon > 0) return null;
            if (heirs.daughters === 1) return new Fraction(1, 6);
            if (heirs.daughters >= 2) return new Fraction(0, 1);
            if (heirs.granddaughtersFromSon === 1) return new Fraction(1, 2);
            return new Fraction(2, 3);
          },
          dalil:
            '–•–∞–¥–∏—Å –æ—Ç –ò–±–Ω –ú–∞—Å—É–¥–∞ (–ë—É—Ö–∞—Ä–∏): "–í–Ω—É—á–∫–µ –æ—Ç —Å—ã–Ω–∞ ‚Äî 1/6 –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ 2/3"',
        },
        FATHER: {
          id: "father",
          nameRu: "–û—Ç–µ—Ü",
          nameAr: "ÿßŸÑÿ£ÿ®",
          category: "ascendant",
          gender: "male",
          isAsaba: true,
          getShare: (heirs) => {
            if (hasMaleDescendants(heirs)) return new Fraction(1, 6);
            if (heirs.daughters > 0 || heirs.granddaughtersFromSon > 0)
              return new Fraction(1, 6);
            return null;
          },
          dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:11',
        },
        MOTHER: {
          id: "mother",
          nameRu: "–ú–∞—Ç—å",
          nameAr: "ÿßŸÑÿ£ŸÖ",
          category: "ascendant",
          gender: "female",
          isAsaba: false,
          getShare: (heirs) => {
            if (hasChildren(heirs) || hasMultipleSiblings(heirs))
              return new Fraction(1, 6);
            return new Fraction(1, 3);
          },
          dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:11',
        },
        PATERNAL_GRANDFATHER: {
          id: "paternalGrandfather",
          nameRu: "–î–µ–¥ (–æ—Ç–µ—Ü –æ—Ç—Ü–∞)",
          nameAr: "ÿßŸÑÿ¨ÿØ",
          category: "ascendant",
          gender: "male",
          isAsaba: true,
          getShare: (heirs) => {
            if (hasMaleDescendants(heirs)) return new Fraction(1, 6);
            if (heirs.daughters > 0 || heirs.granddaughtersFromSon > 0)
              return new Fraction(1, 6);
            return null;
          },
          dalil: "–ò–¥–∂–º–∞ —É—á–µ–Ω—ã—Ö: –¥–µ–¥ –Ω–∞—Å–ª–µ–¥—É–µ—Ç –∫–∞–∫ –æ—Ç–µ—Ü –ø—Ä–∏ –µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏",
        },
        PATERNAL_GRANDMOTHER: {
          id: "paternalGrandmother",
          nameRu: "–ë–∞–±—É—à–∫–∞ (–º–∞—Ç—å –æ—Ç—Ü–∞)",
          nameAr: "ÿßŸÑÿ¨ÿØÿ© ŸÖŸÜ ÿ¨Ÿáÿ© ÿßŸÑÿ£ÿ®",
          category: "ascendant",
          gender: "female",
          isAsaba: false,
          getShare: () => new Fraction(1, 6),
          dalil: "–•–∞–¥–∏—Å: –ü—Ä–æ—Ä–æ–∫ Ô∑∫ –≤—ã–¥–µ–ª–∏–ª –±–∞–±—É—à–∫–µ 1/6 (–ê–±—É –î–∞—É–¥, –¢–∏—Ä–º–∏–∑–∏)",
        },
        MATERNAL_GRANDMOTHER: {
          id: "maternalGrandmother",
          nameRu: "–ë–∞–±—É—à–∫–∞ (–º–∞—Ç—å –º–∞—Ç–µ—Ä–∏)",
          nameAr: "ÿßŸÑÿ¨ÿØÿ© ŸÖŸÜ ÿ¨Ÿáÿ© ÿßŸÑÿ£ŸÖ",
          category: "ascendant",
          gender: "female",
          isAsaba: false,
          getShare: () => new Fraction(1, 6),
          dalil: "–•–∞–¥–∏—Å: –ü—Ä–æ—Ä–æ–∫ Ô∑∫ –≤—ã–¥–µ–ª–∏–ª –±–∞–±—É—à–∫–µ 1/6 (–ê–±—É –î–∞—É–¥, –¢–∏—Ä–º–∏–∑–∏)",
        },
        FULL_BROTHER: {
          id: "fullBrothers",
          nameRu: "–†–æ–¥–Ω–æ–π –±—Ä–∞—Ç",
          nameAr: "ÿßŸÑÿ£ÿÆ ÿßŸÑÿ¥ŸÇŸäŸÇ",
          category: "sibling",
          gender: "male",
          isAsaba: true,
          getShare: () => null,
          dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:176',
        },
        FULL_SISTER: {
          id: "fullSisters",
          nameRu: "–†–æ–¥–Ω–∞—è —Å–µ—Å—Ç—Ä–∞",
          nameAr: "ÿßŸÑÿ£ÿÆÿ™ ÿßŸÑÿ¥ŸÇŸäŸÇÿ©",
          category: "sibling",
          gender: "female",
          isAsaba: false,
          getShare: (heirs) => {
            if (heirs.fullBrothers > 0) return null;
            if (heirs.fullSisters === 1) return new Fraction(1, 2);
            return new Fraction(2, 3);
          },
          dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:176',
        },
        PATERNAL_BROTHER: {
          id: "paternalBrothers",
          nameRu: "–ï–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–π –±—Ä–∞—Ç",
          nameAr: "ÿßŸÑÿ£ÿÆ ŸÑÿ£ÿ®",
          category: "sibling",
          gender: "male",
          isAsaba: true,
          getShare: () => null,
          dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:176 (–ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏)',
        },
        PATERNAL_SISTER: {
          id: "paternalSisters",
          nameRu: "–ï–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω–∞—è —Å–µ—Å—Ç—Ä–∞",
          nameAr: "ÿßŸÑÿ£ÿÆÿ™ ŸÑÿ£ÿ®",
          category: "sibling",
          gender: "female",
          isAsaba: false,
          getShare: (heirs) => {
            if (heirs.paternalBrothers > 0) return null;
            if (heirs.fullSisters === 1) return new Fraction(1, 6);
            if (heirs.fullSisters >= 2) return new Fraction(0, 1);
            if (heirs.paternalSisters === 1) return new Fraction(1, 2);
            return new Fraction(2, 3);
          },
          dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:176 (–ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏)',
        },
        MATERNAL_BROTHER: {
          id: "maternalBrothers",
          nameRu: "–ï–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω—ã–π –±—Ä–∞—Ç",
          nameAr: "ÿßŸÑÿ£ÿÆ ŸÑÿ£ŸÖ",
          category: "sibling",
          gender: "male",
          isAsaba: false,
          getShare: (heirs) => {
            if (heirs.father || hasChildren(heirs)) return new Fraction(0, 1);
            const totalMaternal =
              (heirs.maternalBrothers || 0) + (heirs.maternalSisters || 0);
            if (totalMaternal === 1) return new Fraction(1, 6);
            return new Fraction(1, 3);
          },
          dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:12',
        },
        MATERNAL_SISTER: {
          id: "maternalSisters",
          nameRu: "–ï–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω–∞—è —Å–µ—Å—Ç—Ä–∞",
          nameAr: "ÿßŸÑÿ£ÿÆÿ™ ŸÑÿ£ŸÖ",
          category: "sibling",
          gender: "female",
          isAsaba: false,
          getShare: (heirs) => {
            if (heirs.father || hasChildren(heirs)) return new Fraction(0, 1);
            const totalMaternal =
              (heirs.maternalBrothers || 0) + (heirs.maternalSisters || 0);
            if (totalMaternal === 1) return new Fraction(1, 6);
            return new Fraction(1, 3);
          },
          dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:12',
        },
      };

      /**
       * –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∞—Å–∞–±–∞
       */
      const AsabaPriority = [
        { key: "sons", type: HeirTypes.SON, countField: "sons" },
        {
          key: "grandsonsFromSon",
          type: HeirTypes.GRANDSON_FROM_SON,
          countField: "grandsonsFromSon",
        },
        { key: "father", type: HeirTypes.FATHER, countField: "father" },
        {
          key: "paternalGrandfather",
          type: HeirTypes.PATERNAL_GRANDFATHER,
          countField: "paternalGrandfather",
        },
        {
          key: "fullBrothers",
          type: HeirTypes.FULL_BROTHER,
          countField: "fullBrothers",
        },
        {
          key: "paternalBrothers",
          type: HeirTypes.PATERNAL_BROTHER,
          countField: "paternalBrothers",
        },
      ];

      /**
       * –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –∞—Å–∞–±–∞
       * @param {object} heirs - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @returns {object|null}
       */
      function determineAsaba(heirs) {
        for (const asabaInfo of AsabaPriority) {
          const count = heirs[asabaInfo.countField];
          if (!count || count === 0 || count === false) continue;

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
          if (asabaInfo.key === "grandsonsFromSon" && heirs.sons > 0) continue;
          if (asabaInfo.key === "paternalGrandfather" && heirs.father) continue;
          if (
            (asabaInfo.key === "fullBrothers" ||
              asabaInfo.key === "paternalBrothers") &&
            (heirs.father || heirs.sons > 0 || heirs.grandsonsFromSon > 0)
          )
            continue;
          if (asabaInfo.key === "paternalBrothers" && heirs.fullBrothers > 0)
            continue;

          const asabaCount = count === true ? 1 : count;
          let femaleCount = 0;
          let femaleType = null;

          if (asabaInfo.key === "sons") {
            femaleCount = heirs.daughters || 0;
            femaleType = HeirTypes.DAUGHTER;
          } else if (asabaInfo.key === "grandsonsFromSon") {
            femaleCount = heirs.granddaughtersFromSon || 0;
            femaleType = HeirTypes.GRANDDAUGHTER_FROM_SON;
          } else if (asabaInfo.key === "fullBrothers") {
            femaleCount = heirs.fullSisters || 0;
            femaleType = HeirTypes.FULL_SISTER;
          } else if (asabaInfo.key === "paternalBrothers") {
            femaleCount = heirs.paternalSisters || 0;
            femaleType = HeirTypes.PATERNAL_SISTER;
          }

          return {
            maleType: asabaInfo.type,
            maleCount: asabaCount,
            femaleType,
            femaleCount,
            hasFemales: femaleCount > 0,
            key: asabaInfo.key,
          };
        }
        return null;
      }

      /**
       * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—É–º–º—É —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–ª–µ–π
       * @param {object} heirs - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @returns {Fraction}
       */
      function calculateFixedSharesTotal(heirs) {
        let total = new Fraction(0, 1);

        // –°—É–ø—Ä—É–≥
        if (heirs.husband) {
          total = total.add(HeirTypes.HUSBAND.getShare(heirs));
        } else if (heirs.wife) {
          total = total.add(HeirTypes.WIFE.getShare(heirs));
        }

        // –ú–∞—Ç—å
        if (heirs.mother) {
          total = total.add(HeirTypes.MOTHER.getShare(heirs));
        }

        // –û—Ç–µ—Ü - —Ç–æ–ª—å–∫–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —á–∞—Å—Ç—å
        if (heirs.father) {
          const fatherShare = HeirTypes.FATHER.getShare(heirs);
          if (fatherShare) total = total.add(fatherShare);
        }

        // –î–µ–¥ - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –æ—Ç—Ü–∞
        if (heirs.paternalGrandfather && !heirs.father) {
          const grandfatherShare =
            HeirTypes.PATERNAL_GRANDFATHER.getShare(heirs);
          if (grandfatherShare) total = total.add(grandfatherShare);
        }

        // –ë–∞–±—É—à–∫–∏ - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –º–∞—Ç–µ—Ä–∏
        if (
          (heirs.paternalGrandmother || heirs.maternalGrandmother) &&
          !heirs.mother
        ) {
          total = total.add(new Fraction(1, 6));
        }

        // –î–æ—á–µ—Ä–∏ - —Ç–æ–ª—å–∫–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ–ª—è (–µ—Å–ª–∏ –Ω–µ—Ç —Å—ã–Ω–æ–≤–µ–π)
        if (heirs.daughters > 0 && heirs.sons === 0) {
          const daughterShare = HeirTypes.DAUGHTER.getShare(heirs);
          if (daughterShare) total = total.add(daughterShare);
        }

        // –í–Ω—É—á–∫–∏ –æ—Ç —Å—ã–Ω–∞ - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç —Å—ã–Ω–æ–≤–µ–π
        if (heirs.granddaughtersFromSon > 0 && heirs.sons === 0) {
          const granddaughterShare =
            HeirTypes.GRANDDAUGHTER_FROM_SON.getShare(heirs);
          if (granddaughterShare && !granddaughterShare.isZero()) {
            total = total.add(granddaughterShare);
          }
        }

        // –†–æ–¥–Ω—ã–µ —Å–µ—Å—Ç—Ä—ã - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –±—Ä–∞—Ç—å–µ–≤ –∏ –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
        if (
          heirs.fullSisters > 0 &&
          heirs.fullBrothers === 0 &&
          !heirs.father &&
          heirs.sons === 0 &&
          heirs.grandsonsFromSon === 0
        ) {
          const sisterShare = HeirTypes.FULL_SISTER.getShare(heirs);
          if (sisterShare) total = total.add(sisterShare);
        }

        // –ï–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–µ —Å–µ—Å—Ç—Ä—ã
        if (
          heirs.paternalSisters > 0 &&
          heirs.paternalBrothers === 0 &&
          heirs.fullBrothers === 0 &&
          !heirs.father &&
          heirs.sons === 0 &&
          heirs.grandsonsFromSon === 0
        ) {
          const paternalSisterShare = HeirTypes.PATERNAL_SISTER.getShare(heirs);
          if (paternalSisterShare && !paternalSisterShare.isZero()) {
            total = total.add(paternalSisterShare);
          }
        }

        // –ï–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω—ã–µ –±—Ä–∞—Ç—å—è/—Å–µ—Å—Ç—Ä—ã (–ø—Ä–∏ –∫–∞–ª—è–ª—è)
        if (!heirs.father && !hasChildren(heirs)) {
          const totalMaternal =
            (heirs.maternalBrothers || 0) + (heirs.maternalSisters || 0);
          if (totalMaternal > 0) {
            const maternalShare =
              totalMaternal === 1 ? new Fraction(1, 6) : new Fraction(1, 3);
            total = total.add(maternalShare);
          }
        }

        return total;
      }

      /**
       * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫ –ø–æ—Å–ª–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–ª–µ–π
       * @param {object} heirs - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @returns {Fraction}
       */
      function calculateRemainder(heirs) {
        const fixedTotal = calculateFixedSharesTotal(heirs);
        const one = new Fraction(1, 1);
        const remainder = one.subtract(fixedTotal);
        return remainder.greaterThan(new Fraction(0, 1))
          ? remainder
          : new Fraction(0, 1);
      }

      /**
       * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∞–ª—å-–ê–≤–ª—å
       * @param {object} heirs - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @returns {boolean}
       */
      function needsAwl(heirs) {
        const fixedTotal = calculateFixedSharesTotal(heirs);
        return fixedTotal.greaterThan(new Fraction(1, 1));
      }

      /**
       * –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ê–≤–ª—å
       * @param {object} heirs - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @returns {Fraction}
       */
      function calculateAwlRatio(heirs) {
        const fixedTotal = calculateFixedSharesTotal(heirs);
        if (!fixedTotal.greaterThan(new Fraction(1, 1))) {
          return new Fraction(1, 1);
        }
        return new Fraction(1, 1).divide(fixedTotal);
      }

      /**
       * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω—É–∂–Ω–æ –ª–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∞—Ä-–†–∞–¥–¥
       * @param {object} heirs - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @returns {boolean}
       */
      function needsRadd(heirs) {
        const remainder = calculateRemainder(heirs);
        const asabaInfo = determineAsaba(heirs);
        return remainder.greaterThan(new Fraction(0, 1)) && !asabaInfo;
      }

      /**
       * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–ª—É—á–∞–π –∞–ª—å-–£–º–∞—Ä–∏–π—è—Ç–∞–π–Ω
       * @param {object} heirs - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
       * @returns {object|null}
       */
      function checkUmariyyatan(heirs) {
        const hasSpouse = heirs.husband || heirs.wife;
        if (!hasSpouse || !heirs.father || !heirs.mother) return null;
        if (
          heirs.sons > 0 ||
          heirs.daughters > 0 ||
          heirs.grandsonsFromSon > 0 ||
          heirs.granddaughtersFromSon > 0
        )
          return null;
        if (
          heirs.fullBrothers > 0 ||
          heirs.fullSisters > 0 ||
          heirs.paternalBrothers > 0 ||
          heirs.paternalSisters > 0 ||
          heirs.maternalBrothers > 0 ||
          heirs.maternalSisters > 0
        )
          return null;
        if (
          heirs.paternalGrandfather ||
          heirs.paternalGrandmother ||
          heirs.maternalGrandmother
        )
          return null;

        return {
          applies: true,
          caseNumber: heirs.husband ? 1 : 2,
          description: heirs.husband
            ? "–°–ª—É—á–∞–π –∞–ª—å-–£–º–∞—Ä–∏–π—è—Ç–∞–π–Ω —Å –º—É–∂–µ–º: –º—É–∂ –ø–æ–ª—É—á–∞–µ—Ç 1/2, –º–∞—Ç—å ‚Äî 1/3 –æ—Ç –æ—Å—Ç–∞—Ç–∫–∞, –æ—Ç–µ—Ü ‚Äî –æ—Å—Ç–∞—Ç–æ–∫"
            : "–°–ª—É—á–∞–π –∞–ª—å-–£–º–∞—Ä–∏–π—è—Ç–∞–π–Ω —Å –∂–µ–Ω–æ–π: –∂–µ–Ω–∞ –ø–æ–ª—É—á–∞–µ—Ç 1/4, –º–∞—Ç—å ‚Äî 1/3 –æ—Ç –æ—Å—Ç–∞—Ç–∫–∞, –æ—Ç–µ—Ü ‚Äî –æ—Å—Ç–∞—Ç–æ–∫",
        };
      }

      // ========================================
      // State Management
      // ========================================
      const AppState = {
        // –§–ª–∞–≥ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ —ç—Ç–∞–ø–∞
        obligationsAccepted: false,

        // –°—É–º–º–∞ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞
        totalEstate: 0,

        // –í—ã–±—Ä–∞–Ω–Ω—ã–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∏
        heirs: {
          // –°—É–ø—Ä—É–≥–∏
          husband: false,
          wife: false,
          wifeCount: 1,

          // –ü–æ—Ç–æ–º–∫–∏
          sons: 0,
          daughters: 0,
          grandsonsFromSon: 0,
          granddaughtersFromSon: 0,

          // –ü—Ä–µ–¥–∫–∏
          father: false,
          mother: false,
          paternalGrandfather: false,
          paternalGrandmother: false,
          maternalGrandmother: false,

          // –ë—Ä–∞—Ç—å—è –∏ —Å–µ—Å—Ç—Ä—ã
          fullBrothers: 0,
          fullSisters: 0,
          paternalBrothers: 0,
          paternalSisters: 0,
          maternalBrothers: 0,
          maternalSisters: 0,
          nephewsFullBrothers: 0,
          nephewsPaternalBrothers: 0,
          unclesFull: 0,
          unclesPaternal: 0,
        },

        // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞
        results: null,

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –æ—Å–æ–±—ã–µ –ø—Ä–∞–≤–∏–ª–∞
        appliedRules: {
          awl: false,
          radd: false,
          umariyyatan: false,
        },

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–∞
        remainderDestination: "treasury", // treasury | charity
      };

      // ========================================
      // DOM Elements
      // ========================================
      const DOM = {
        // Modal elements
        obligationsModal: document.getElementById("obligations-modal"),
        obligationsCheckbox: document.getElementById("obligations-checkbox"),
        continueBtn: document.getElementById("continue-btn"),

        // Main sections
        calculatorMain: document.getElementById("calculator-main"),
        resultsSection: document.getElementById("results-section"),

        // Form elements - Estate
        estateAmount: document.getElementById("estate-amount"),
        estateError: document.getElementById("estate-error"),

        // Form elements - Spouse
        spouseRadios: document.querySelectorAll('input[name="spouse"]'),
        spouseHint: document.getElementById("spouse-hint"),
        wifeCountGroup: document.getElementById("wife-count-group"),
        wifeCount: document.getElementById("wife-count"),

        // Form elements - Descendants
        sons: document.getElementById("sons"),
        daughters: document.getElementById("daughters"),
        grandsonsFromSon: document.getElementById("grandsons-from-son"),
        granddaughtersFromSon: document.getElementById(
          "granddaughters-from-son"
        ),
        grandsonsBlocked: document.getElementById("grandsons-blocked"),
        granddaughtersBlocked: document.getElementById(
          "granddaughters-blocked"
        ),

        // Form elements - Ancestors
        father: document.getElementById("father"),
        mother: document.getElementById("mother"),
        paternalGrandfather: document.getElementById("paternal-grandfather"),
        paternalGrandmother: document.getElementById("paternal-grandmother"),
        maternalGrandmother: document.getElementById("maternal-grandmother"),
        grandfatherBlocked: document.getElementById("grandfather-blocked"),
        paternalGrandmotherBlocked: document.getElementById(
          "paternal-grandmother-blocked"
        ),

        // Form elements - Siblings
        fullBrothers: document.getElementById("full-brothers"),
        fullSisters: document.getElementById("full-sisters"),
        paternalBrothers: document.getElementById("paternal-brothers"),
        paternalSisters: document.getElementById("paternal-sisters"),
        maternalBrothers: document.getElementById("maternal-brothers"),
        maternalSisters: document.getElementById("maternal-sisters"),
        fullBrothersBlocked: document.getElementById("full-brothers-blocked"),
        fullSistersBlocked: document.getElementById("full-sisters-blocked"),
        paternalBrothersBlocked: document.getElementById(
          "paternal-brothers-blocked"
        ),
        paternalSistersBlocked: document.getElementById(
          "paternal-sisters-blocked"
        ),
        maternalBrothersBlocked: document.getElementById(
          "maternal-brothers-blocked"
        ),
        maternalSistersBlocked: document.getElementById(
          "maternal-sisters-blocked"
        ),
        nephewsFullBrothers: document.getElementById("nephews-full-brothers"),
        nephewsPaternalBrothers: document.getElementById(
          "nephews-paternal-brothers"
        ),
        unclesFull: document.getElementById("uncles-full"),
        unclesPaternal: document.getElementById("uncles-paternal"),
        distantAsabaBlocked: document.getElementById("distant-asaba-blocked"),

        // Calculate button
        calculateBtn: document.getElementById("calculate-btn"),
      };

      // ========================================
      // Modal Controller (–®–∞–≥ 0)
      // ========================================
      const ModalController = {
        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
         * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
         */
        init() {
          // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
          this.showModal();

          // –ü—Ä–∏–≤—è–∑–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
          this.bindEvents();
        },

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
         * –ë–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
         */
        showModal() {
          if (DOM.obligationsModal) {
            if (typeof DOM.obligationsModal.showModal === "function") {
              DOM.obligationsModal.showModal();
            } else {
              // jsdom fallback: mark dialog as open when showModal is missing
              DOM.obligationsModal.setAttribute("open", "true");
            }
          }
        },

        /**
         * –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
         */
        hideModal() {
          if (DOM.obligationsModal) {
            console.log("hideModal: Starting to hide modal");

            // –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ
            AppState.obligationsAccepted = true;
            console.log("hideModal: AppState.obligationsAccepted set to true");

            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            if (typeof DOM.obligationsModal.close === "function") {
              DOM.obligationsModal.close();
              console.log("hideModal: modal.close() called");
            } else {
              DOM.obligationsModal.removeAttribute("open");
              console.log(
                "hideModal: modal.close() missing, removed open attr"
              );
            }

            // –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ CSS
            DOM.obligationsModal.style.display = "none";
            DOM.obligationsModal.style.visibility = "hidden";
            DOM.obligationsModal.style.opacity = "0";
            DOM.obligationsModal.style.pointerEvents = "none";

            // –£–±–∏—Ä–∞–µ–º –∞—Ç—Ä–∏–±—É—Ç open –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            DOM.obligationsModal.removeAttribute("open");

            console.log("hideModal: Forced CSS hiding applied");

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –µ—Å–ª–∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Å–µ –µ—â–µ –æ—Ç–∫—Ä—ã—Ç–æ
            setTimeout(() => {
              if (DOM.obligationsModal.open) {
                console.log("hideModal: Modal still open, forcing close");
                DOM.obligationsModal.open = false;
                DOM.obligationsModal.style.display = "none";
              } else {
                console.log("hideModal: Modal successfully closed");
              }
            }, 100);
          } else {
            console.log("hideModal: DOM.obligationsModal not found");
          }
        },

        /**
         * –ü—Ä–∏–≤—è–∑–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
         */
        bindEvents() {
          console.log("bindEvents called");
          console.log("DOM elements check:");
          console.log("- obligationsCheckbox:", DOM.obligationsCheckbox);
          console.log("- continueBtn:", DOM.continueBtn);
          console.log("- obligationsModal:", DOM.obligationsModal);

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ–∫–±–æ–∫—Å–∞
          if (DOM.obligationsCheckbox) {
            console.log("Binding checkbox change event");
            DOM.obligationsCheckbox.addEventListener("change", (e) => {
              console.log("Checkbox change event fired");
              this.handleCheckboxChange(e.target.checked);
            });
          } else {
            console.error("obligationsCheckbox not found!");
          }

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
          if (DOM.continueBtn) {
            console.log("Binding continue button click event");
            DOM.continueBtn.addEventListener("click", (e) => {
              console.log("Continue button click event fired");
              e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ª—é–±–æ–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
              this.handleContinue();
            });
          } else {
            console.error("continueBtn not found!");
          }

          // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ Escape –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
          if (DOM.obligationsModal) {
            DOM.obligationsModal.addEventListener("cancel", (e) => {
              if (!AppState.obligationsAccepted) {
                e.preventDefault();
              }
            });

            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ backdrop, –Ω–æ –Ω–µ –º–µ—à–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–º—É –∑–∞–∫—Ä—ã—Ç–∏—é
            DOM.obligationsModal.addEventListener("click", (e) => {
              if (
                e.target === DOM.obligationsModal &&
                !AppState.obligationsAccepted &&
                e.isTrusted // –¢–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∫–ª–∏–∫–æ–≤, –Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö
              ) {
                e.preventDefault();
              }
            });
          }
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ–∫–±–æ–∫—Å–∞
         * @param {boolean} isChecked - —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–∞
         */
        handleCheckboxChange(isChecked) {
          console.log("handleCheckboxChange called with:", isChecked);
          console.log("Continue button element:", DOM.continueBtn);

          if (DOM.continueBtn) {
            DOM.continueBtn.disabled = !isChecked;
            console.log("Button disabled set to:", !isChecked);
          } else {
            console.error("Continue button not found in handleCheckboxChange!");
          }
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
         * –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä—É –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
         */
        handleContinue() {
          console.log("handleContinue called");
          console.log("Checkbox element:", DOM.obligationsCheckbox);
          console.log(
            "Checkbox checked:",
            DOM.obligationsCheckbox
              ? DOM.obligationsCheckbox.checked
              : "checkbox not found"
          );
          console.log("Button element:", DOM.continueBtn);
          console.log(
            "Button disabled:",
            DOM.continueBtn ? DOM.continueBtn.disabled : "button not found"
          );

          if (DOM.obligationsCheckbox && DOM.obligationsCheckbox.checked) {
            console.log("Continue button clicked, checkbox is checked");

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ü–ï–†–ï–î –ª—é–±—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏ —Å –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
            AppState.obligationsAccepted = true;
            console.log("AppState.obligationsAccepted set to true");

            // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            this.hideModal();
            console.log("hideModal() called");

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
            setTimeout(() => {
              this.showCalculator();
              console.log("showCalculator() called");
            }, 150);
          } else {
            console.log(
              "Continue button clicked but checkbox is not checked or not found"
            );
            if (!DOM.obligationsCheckbox) {
              console.error("Checkbox element not found!");
            } else if (!DOM.obligationsCheckbox.checked) {
              console.error("Checkbox is not checked!");
            }
          }
        },

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
         */
        showCalculator() {
          if (DOM.calculatorMain) {
            DOM.calculatorMain.classList.remove("hidden");

            // –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            if (globalThis.innerWidth <= 767) {
              DOM.calculatorMain.style.opacity = "0";
              DOM.calculatorMain.style.transform = "translateY(20px)";

              setTimeout(() => {
                DOM.calculatorMain.style.transition =
                  "opacity 0.3s ease, transform 0.3s ease";
                DOM.calculatorMain.style.opacity = "1";
                DOM.calculatorMain.style.transform = "translateY(0)";
              }, 50);
            }
          }
        },
      };

      // ========================================
      // Validation Engine
      // ========================================
      const ValidationEngine = {
        /**
         * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —á–∏—Å–ª–æ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ —Ç—ã—Å—è—á
         * @param {number|string} value - –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
         * @returns {string} - –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
         */
        formatNumber(value) {
          if (value === "" || value === null || value === undefined) return "";
          const num = Number.parseFloat(
            String(value).replaceAll(/\s/g, "").replaceAll(",", ".")
          );
          if (Number.isNaN(num)) return "";
          return new Intl.NumberFormat("ru-RU").format(num);
        },

        /**
         * –ü–∞—Ä—Å–∏—Ç –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —á–∏—Å–ª–æ –æ–±—Ä–∞—Ç–Ω–æ –≤ —á–∏—Å–ª–æ
         * @param {string} value - –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
         * @returns {number} - —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
         */
        parseFormattedNumber(value) {
          if (!value) return 0;
          // –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã (—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Ç—ã—Å—è—á) –∏ –∑–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É
          const cleaned = String(value)
            .replaceAll(/\s/g, "")
            .replaceAll(",", ".");
          const num = Number.parseFloat(cleaned);
          return Number.isNaN(num) ? 0 : num;
        },

        /**
         * –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å—É–º–º—É –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞
         * @param {string} value - –≤–≤–µ–¥–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
         * @returns {object} - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ {valid: boolean, error: string, value: number}
         */
        validateEstateAmount(value) {
          if (!value || value.trim() === "") {
            return {
              valid: false,
              error: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞",
              value: 0,
            };
          }

          const num = this.parseFormattedNumber(value);

          if (Number.isNaN(num)) {
            return {
              valid: false,
              error: "–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —á–∏—Å–ª–æ",
              value: 0,
            };
          }

          if (num < 0) {
            return {
              valid: false,
              error: "–°—É–º–º–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π",
              value: 0,
            };
          }

          if (num === 0) {
            return {
              valid: false,
              error: "–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ –Ω—É–ª—è",
              value: 0,
            };
          }

          return { valid: true, error: "", value: num };
        },

        /**
         * –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ü–µ–ª–æ–µ –Ω–µ–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ
         * @param {string|number} value - –≤–≤–µ–¥–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
         * @returns {object} - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ {valid: boolean, value: number}
         */
        validateNonNegativeInteger(value) {
          const num = Number.parseInt(value, 10);
          if (Number.isNaN(num) || num < 0) {
            return { valid: false, value: 0 };
          }
          return { valid: true, value: Math.floor(num) };
        },

        /**
         * –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–µ–Ω (1-4)
         * @param {string|number} value - –≤–≤–µ–¥–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
         * @returns {object} - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ {valid: boolean, value: number}
         */
        validateWifeCount(value) {
          const num = Number.parseInt(value, 10);
          if (Number.isNaN(num) || num < 1) {
            return { valid: true, value: 1 };
          }
          if (num > 4) {
            return { valid: true, value: 4 };
          }
          return { valid: true, value: num };
        },
      };

      // ========================================
      // Form Controller
      // ========================================
      const FormController = {
        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —Ñ–æ—Ä–º—ã
         */
        init() {
          this.bindEvents();
          this.updateSpouseHint();
        },

        /**
         * –ü—Ä–∏–≤—è–∑–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
         */
        bindEvents() {
          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ —Å—É–º–º—ã –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞
          if (DOM.estateAmount) {
            DOM.estateAmount.addEventListener("input", (e) => {
              this.handleEstateInput(e);
            });

            DOM.estateAmount.addEventListener("blur", (e) => {
              this.handleEstateBlur(e);
            });

            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤–≤–æ–¥ –Ω–µ—á–∏—Å–ª–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
            DOM.estateAmount.addEventListener("keypress", (e) => {
              this.handleEstateKeypress(e);
            });
          }

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–±–æ—Ä–∞ —Å—É–ø—Ä—É–≥–∞
          DOM.spouseRadios.forEach((radio) => {
            radio.addEventListener("change", (e) => {
              this.handleSpouseChange(e);
            });
          });

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∂–µ–Ω
          if (DOM.wifeCount) {
            DOM.wifeCount.addEventListener("change", (e) => {
              this.handleWifeCountChange(e);
            });

            DOM.wifeCount.addEventListener("blur", (e) => {
              this.handleWifeCountChange(e);
            });
          }

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª–µ–π –ø–æ—Ç–æ–º–∫–æ–≤
          this.bindDescendantEvents();

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª–µ–π –ø—Ä–µ–¥–∫–æ–≤
          this.bindAncestorEvents();

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø–æ–ª–µ–π –±—Ä–∞—Ç—å–µ–≤/—Å–µ—Å—Ç–µ—Ä
          this.bindSiblingEvents();
        },

        /**
         * –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–æ–ª–µ–π –ø–æ—Ç–æ–º–∫–æ–≤
         */
        bindDescendantEvents() {
          const descendantFields = [
            DOM.sons,
            DOM.daughters,
            DOM.grandsonsFromSon,
            DOM.granddaughtersFromSon,
          ];

          descendantFields.forEach((field) => {
            if (field) {
              field.addEventListener("change", (e) => {
                this.handleNumberFieldChange(e, field.id);
              });

              field.addEventListener("blur", (e) => {
                this.handleNumberFieldChange(e, field.id);
              });
            }
          });
        },

        /**
         * –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–æ–ª–µ–π –ø—Ä–µ–¥–∫–æ–≤
         */
        bindAncestorEvents() {
          const ancestorCheckboxes = [
            DOM.father,
            DOM.mother,
            DOM.paternalGrandfather,
            DOM.paternalGrandmother,
            DOM.maternalGrandmother,
          ];

          ancestorCheckboxes.forEach((checkbox) => {
            if (checkbox) {
              checkbox.addEventListener("change", (e) => {
                this.handleAncestorChange(e);
              });
            }
          });
        },

        /**
         * –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–æ–ª–µ–π –±—Ä–∞—Ç—å–µ–≤/—Å–µ—Å—Ç–µ—Ä
         */
        bindSiblingEvents() {
          const siblingFields = [
            DOM.fullBrothers,
            DOM.fullSisters,
            DOM.paternalBrothers,
            DOM.paternalSisters,
            DOM.maternalBrothers,
            DOM.maternalSisters,
            DOM.nephewsFullBrothers,
            DOM.nephewsPaternalBrothers,
            DOM.unclesFull,
            DOM.unclesPaternal,
          ];

          siblingFields.forEach((field) => {
            if (field) {
              field.addEventListener("change", (e) => {
                this.handleNumberFieldChange(e, field.id);
              });

              field.addEventListener("blur", (e) => {
                this.handleNumberFieldChange(e, field.id);
              });
            }
          });
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ —Å—É–º–º—ã –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞
         * @param {Event} e - —Å–æ–±—ã—Ç–∏–µ –≤–≤–æ–¥–∞
         */
        handleEstateInput(e) {
          const input = e.target;
          let value = input.value;

          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
          const cursorPos = input.selectionStart;
          const oldLength = value.length;

          // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä, —Ç–æ—á–∫–∏ –∏ –∑–∞–ø—è—Ç–æ–π
          value = value.replaceAll(/[^\d.,\s]/g, "");

          // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
          input.value = value;

          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∫—É—Ä—Å–æ—Ä–∞
          const newLength = value.length;
          const newCursorPos = cursorPos - (oldLength - newLength);
          input.setSelectionRange(newCursorPos, newCursorPos);

          // –û—á–∏—â–∞–µ–º –æ—à–∏–±–∫—É –ø—Ä–∏ –≤–≤–æ–¥–µ
          this.clearEstateError();

          // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
          if (globalThis.innerWidth <= 767) {
            input.style.borderColor = "var(--color-primary-light)";
            setTimeout(() => {
              input.style.borderColor = "";
            }, 300);
          }
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ—Ç–µ—Ä–∏ —Ñ–æ–∫—É—Å–∞ –ø–æ–ª—è —Å—É–º–º—ã
         * @param {Event} e - —Å–æ–±—ã—Ç–∏–µ blur
         */
        handleEstateBlur(e) {
          const input = e.target;
          const validation = ValidationEngine.validateEstateAmount(input.value);

          if (validation.valid) {
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–æ —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ —Ç—ã—Å—è—á
            input.value = ValidationEngine.formatNumber(validation.value);
            AppState.totalEstate = validation.value;
            this.clearEstateError();
          } else if (input.value.trim() !== "") {
            this.showEstateError(validation.error);
          }
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à –≤ –ø–æ–ª–µ —Å—É–º–º—ã
         * @param {KeyboardEvent} e - —Å–æ–±—ã—Ç–∏–µ keypress
         */
        handleEstateKeypress(e) {
          // –†–∞–∑—Ä–µ—à–∞–µ–º: —Ü–∏—Ñ—Ä—ã, —Ç–æ—á–∫—É, –∑–∞–ø—è—Ç—É—é, backspace, delete, —Å—Ç—Ä–µ–ª–∫–∏
          const allowedKeys = [
            "0",
            "1",
            "2",
            "3",
            "4",
            "5",
            "6",
            "7",
            "8",
            "9",
            ".",
            ",",
          ];

          if (!allowedKeys.includes(e.key) && !e.ctrlKey && !e.metaKey) {
            // –†–∞–∑—Ä–µ—à–∞–µ–º —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ –∫–ª–∞–≤–∏—à–∏
            if (
              e.key !== "Backspace" &&
              e.key !== "Delete" &&
              e.key !== "ArrowLeft" &&
              e.key !== "ArrowRight" &&
              e.key !== "Tab" &&
              e.key !== "Enter"
            ) {
              e.preventDefault();
            }
          }
        },

        /**
         * –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É —Å—É–º–º—ã –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞
         * @param {string} message - —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
         */
        showEstateError(message) {
          if (DOM.estateError) {
            DOM.estateError.textContent = message;
            DOM.estateError.style.display = "block";
          }
          if (DOM.estateAmount) {
            DOM.estateAmount.style.borderColor = "var(--color-error)";
          }
        },

        /**
         * –û—á–∏—Å—Ç–∏—Ç—å –æ—à–∏–±–∫—É —Å—É–º–º—ã –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞
         */
        clearEstateError() {
          if (DOM.estateError) {
            DOM.estateError.textContent = "";
            DOM.estateError.style.display = "none";
          }
          if (DOM.estateAmount) {
            DOM.estateAmount.style.borderColor = "";
          }
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ —Å—É–ø—Ä—É–≥–∞
         * @param {Event} e - —Å–æ–±—ã—Ç–∏–µ change
         */
        handleSpouseChange(e) {
          const value = e.target.value;

          // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
          AppState.heirs.husband = value === "husband";
          AppState.heirs.wife = value === "wife";

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∂–µ–Ω
          if (DOM.wifeCountGroup) {
            if (value === "wife") {
              DOM.wifeCountGroup.classList.remove("hidden");
            } else {
              DOM.wifeCountGroup.classList.add("hidden");
              AppState.heirs.wifeCount = 1;
              if (DOM.wifeCount) {
                DOM.wifeCount.value = 1;
              }
            }
          }

          // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –æ –¥–æ–ª–µ
          this.updateSpouseHint();
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∂–µ–Ω
         * @param {Event} e - —Å–æ–±—ã—Ç–∏–µ change
         */
        handleWifeCountChange(e) {
          const validation = ValidationEngine.validateWifeCount(e.target.value);
          e.target.value = validation.value;
          AppState.heirs.wifeCount = validation.value;
        },

        /**
         * –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É –æ –¥–æ–ª–µ —Å—É–ø—Ä—É–≥–∞
         */
        updateSpouseHint() {
          if (!DOM.spouseHint) return;

          const hasChildren =
            AppState.heirs.sons > 0 ||
            AppState.heirs.daughters > 0 ||
            AppState.heirs.grandsonsFromSon > 0 ||
            AppState.heirs.granddaughtersFromSon > 0;

          if (AppState.heirs.husband) {
            const share = hasChildren ? "1/4" : "1/2";
            const condition = hasChildren
              ? I18n.t("conditions.withChildren")
              : I18n.t("conditions.withoutChildren");
            DOM.spouseHint.textContent = I18n.t("spouse.husbandShareHint", {
              share,
              condition,
            });
            DOM.spouseHint.style.display = "block";
          } else if (AppState.heirs.wife) {
            const share = hasChildren ? "1/8" : "1/4";
            const condition = hasChildren
              ? I18n.t("conditions.withChildren")
              : I18n.t("conditions.withoutChildren");
            DOM.spouseHint.textContent = I18n.t("spouse.wifeShareHint", {
              share,
              condition,
            });
            DOM.spouseHint.style.display = "block";
          } else {
            DOM.spouseHint.textContent = "";
            DOM.spouseHint.style.display = "none";
          }
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–∏—Å–ª–æ–≤–æ–≥–æ –ø–æ–ª—è
         * @param {Event} e - —Å–æ–±—ã—Ç–∏–µ change
         * @param {string} fieldId - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—è
         */
        handleNumberFieldChange(e, fieldId) {
          const validation = ValidationEngine.validateNonNegativeInteger(
            e.target.value
          );
          e.target.value = validation.value;

          // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–æ–ª—è
          this.updateStateFromField(fieldId, validation.value);

          // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –æ –¥–æ–ª–µ —Å—É–ø—Ä—É–≥–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ—Ç–æ–º–∫–æ–≤
          const descendantFields = [
            "sons",
            "daughters",
            "grandsons-from-son",
            "granddaughters-from-son",
          ];
          if (descendantFields.includes(fieldId)) {
            this.updateSpouseHint();
          }

          // –û–±–Ω–æ–≤–ª—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π, –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
          const blockingTriggerFields = [
            "sons",
            "daughters",
            "grandsons-from-son",
            "granddaughters-from-son",
            "full-brothers",
            "full-sisters",
            "paternal-brothers",
            "paternal-sisters",
            "nephews-full-brothers",
            "nephews-paternal-brothers",
            "uncles-full",
            "uncles-paternal",
          ];
          if (blockingTriggerFields.includes(fieldId)) {
            BlockingController.updateAllBlockings();
            this.updateDistantAsabaAvailability();
          }

          // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–∫—Ç–∏–ª—å–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
          if (MobileUtils.isMobile() && MobileUtils.isTouchDevice()) {
            // –õ–µ–≥–∫–∞—è –≤–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
            if (navigator.vibrate && validation.value !== 0) {
              navigator.vibrate(50);
            }

            // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
            e.target.style.backgroundColor = "var(--color-bg-alt)";
            setTimeout(() => {
              e.target.style.backgroundColor = "";
            }, 200);
          }
        },

        /**
         * –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ –ø–æ–ª—è —Ñ–æ—Ä–º—ã
         * @param {string} fieldId - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—è
         * @param {number} value - –∑–Ω–∞—á–µ–Ω–∏–µ
         */
        updateStateFromField(fieldId, value) {
          const fieldMapping = {
            sons: "sons",
            daughters: "daughters",
            "grandsons-from-son": "grandsonsFromSon",
            "granddaughters-from-son": "granddaughtersFromSon",
            "full-brothers": "fullBrothers",
            "full-sisters": "fullSisters",
            "paternal-brothers": "paternalBrothers",
            "paternal-sisters": "paternalSisters",
            "maternal-brothers": "maternalBrothers",
            "maternal-sisters": "maternalSisters",
            "nephews-full-brothers": "nephewsFullBrothers",
            "nephews-paternal-brothers": "nephewsPaternalBrothers",
            "uncles-full": "unclesFull",
            "uncles-paternal": "unclesPaternal",
          };

          const stateKey = fieldMapping[fieldId];
          if (stateKey) {
            console.log(
              `=== –û–¢–õ–ê–î–ö–ê: –û–±–Ω–æ–≤–ª—è–µ–º AppState.heirs.${stateKey} = ${value} ===`
            );
            AppState.heirs[stateKey] = value;
            console.log("AppState.heirs –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:", AppState.heirs);
          } else {
            console.warn(
              `=== –û–¢–õ–ê–î–ö–ê: –ù–µ –Ω–∞–π–¥–µ–Ω –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è fieldId: ${fieldId} ===`
            );
          }
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ–∫–±–æ–∫—Å–æ–≤ –ø—Ä–µ–¥–∫–æ–≤
         * @param {Event} e - —Å–æ–±—ã—Ç–∏–µ change
         */
        handleAncestorChange(e) {
          const checkbox = e.target;
          const fieldMapping = {
            father: "father",
            mother: "mother",
            "paternal-grandfather": "paternalGrandfather",
            "paternal-grandmother": "paternalGrandmother",
            "maternal-grandmother": "maternalGrandmother",
          };

          const stateKey = fieldMapping[checkbox.id];
          if (stateKey) {
            console.log(
              `=== –û–¢–õ–ê–î–ö–ê: –û–±–Ω–æ–≤–ª—è–µ–º AppState.heirs.${stateKey} = ${checkbox.checked} ===`
            );
            AppState.heirs[stateKey] = checkbox.checked;
            console.log("AppState.heirs –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:", AppState.heirs);
          } else {
            console.warn(
              `=== –û–¢–õ–ê–î–ö–ê: –ù–µ –Ω–∞–π–¥–µ–Ω –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è checkbox.id: ${checkbox.id} ===`
            );
          }

          // –û–±–Ω–æ–≤–ª—è–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—Ç—Ü–∞, –º–∞—Ç–µ—Ä–∏ –∏–ª–∏ –¥–µ–¥–∞
          if (
            checkbox.id === "father" ||
            checkbox.id === "mother" ||
            checkbox.id === "paternal-grandfather"
          ) {
            BlockingController.updateAllBlockings();
            this.updateDistantAsabaAvailability();
          }
        },

        updateDistantAsabaAvailability() {
          const heirs = AppState.heirs;

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –±–æ–ª–µ–µ –±–ª–∏–∑–∫–∏—Ö –∞—Å–∞–±–∞, –∫–æ—Ç–æ—Ä—ã–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –í–°–ï–• –¥–∞–ª—å–Ω–∏—Ö
          const hasCloserAgnates =
            heirs.sons > 0 ||
            heirs.grandsonsFromSon > 0 ||
            heirs.father ||
            heirs.paternalGrandfather ||
            heirs.fullBrothers > 0 ||
            heirs.paternalBrothers > 0;

          if (hasCloserAgnates) {
            this.disableDistantAsabaInputs(
              true,
              "–î–∞–ª—å–Ω–∏–µ –∞—Å–∞–±–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã: –µ—Å—Ç—å –±–æ–ª–µ–µ –±–ª–∏–∑–∫–∏–µ –º—É–∂—Å–∫–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∏ (—Å—ã–Ω/–≤–Ω—É–∫/–æ—Ç–µ—Ü/–¥–µ–¥/–±—Ä–∞—Ç—å—è)."
            );
          } else {
            this.disableDistantAsabaInputs(false);
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞: –ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç –¥—è–¥–µ–π
            this.updateUnclesAvailability();
          }
        },

        /**
         * –û–±–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ–ª–µ–π –¥—è–¥–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–ª–∏—á–∏—è –ø–ª–µ–º—è–Ω–Ω–∏–∫–æ–≤
         * –ü–ª–µ–º—è–Ω–Ω–∏–∫–∏ (—Å—ã–Ω–æ–≤—å—è –±—Ä–∞—Ç—å–µ–≤) –±–ª–æ–∫–∏—Ä—É—é—Ç –¥—è–¥–µ–π —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º –∞—Å–∞–±–∞
         */
        updateUnclesAvailability() {
          const heirs = AppState.heirs;

          // –°—ã–Ω–æ–≤—å—è –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤ –±–ª–æ–∫–∏—Ä—É—é—Ç –≤—Å–µ—Ö –¥—è–¥–µ–π
          const hasNephewsFromFullBrothers = heirs.nephewsFullBrothers > 0;

          // –°—ã–Ω–æ–≤—å—è –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤ –±–ª–æ–∫–∏—Ä—É—é—Ç –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã—Ö –¥—è–¥–µ–π
          const hasNephewsFromPaternalBrothers =
            heirs.nephewsPaternalBrothers > 0;

          // –ü–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã–µ –¥—è–¥–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å—ã–Ω–æ–≤—å—è–º–∏ –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤
          if (DOM.unclesFull) {
            if (hasNephewsFromFullBrothers) {
              DOM.unclesFull.disabled = true;
              DOM.unclesFull.classList.add("input--disabled");
            } else {
              DOM.unclesFull.disabled = false;
              DOM.unclesFull.classList.remove("input--disabled");
            }
          }

          // –ï–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–µ –¥—è–¥–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å—ã–Ω–æ–≤—å—è–º–∏ –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã—Ö –∏ –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤
          if (DOM.unclesPaternal) {
            if (hasNephewsFromFullBrothers || hasNephewsFromPaternalBrothers) {
              DOM.unclesPaternal.disabled = true;
              DOM.unclesPaternal.classList.add("input--disabled");
            } else {
              DOM.unclesPaternal.disabled = false;
              DOM.unclesPaternal.classList.remove("input--disabled");
            }
          }

          // –°—ã–Ω–æ–≤—å—è –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å—ã–Ω–æ–≤—å—è–º–∏ –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤
          if (DOM.nephewsPaternalBrothers) {
            if (hasNephewsFromFullBrothers) {
              DOM.nephewsPaternalBrothers.disabled = true;
              DOM.nephewsPaternalBrothers.classList.add("input--disabled");
            } else {
              DOM.nephewsPaternalBrothers.disabled = false;
              DOM.nephewsPaternalBrothers.classList.remove("input--disabled");
            }
          }

          // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
          if (DOM.distantAsabaBlocked) {
            let blockingReasons = [];
            if (hasNephewsFromFullBrothers) {
              blockingReasons.push(
                "–°—ã–Ω–æ–≤—å—è –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤ –±–ª–æ–∫–∏—Ä—É—é—Ç: –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã—Ö –ø–ª–µ–º—è–Ω–Ω–∏–∫–æ–≤ –∏ –≤—Å–µ—Ö –¥—è–¥–µ–π"
              );
            } else if (hasNephewsFromPaternalBrothers) {
              blockingReasons.push(
                "–°—ã–Ω–æ–≤—å—è –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤ –±–ª–æ–∫–∏—Ä—É—é—Ç: –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã—Ö –¥—è–¥–µ–π"
              );
            }
            DOM.distantAsabaBlocked.textContent = blockingReasons.join(". ");
          }
        },

        /**
         * –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª–µ–π –¥–∞–ª—å–Ω–∏—Ö –∞—Å–∞–∞–±–∞
         * @param {boolean} disabled - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
         * @param {string} reason - –ø—Ä–∏—á–∏–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
         */
        disableDistantAsabaInputs(disabled, reason = "") {
          const inputs = [
            DOM.nephewsFullBrothers,
            DOM.nephewsPaternalBrothers,
            DOM.unclesFull,
            DOM.unclesPaternal,
          ];
          inputs.forEach((el) => {
            if (!el) return;
            el.disabled = disabled;
            if (disabled) {
              el.classList.add("input--disabled");
            } else {
              el.classList.remove("input--disabled");
            }
          });
          if (DOM.distantAsabaBlocked) {
            DOM.distantAsabaBlocked.textContent = disabled ? reason : "";
          }
        },

        /**
         * –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
         * @returns {object} - –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
         */
        getFormData() {
          // –í–∞–ª–∏–¥–∏—Ä—É–µ–º —Å—É–º–º—É
          const estateValidation = ValidationEngine.validateEstateAmount(
            DOM.estateAmount?.value || ""
          );

          return {
            totalEstate: estateValidation.value,
            estateValid: estateValidation.valid,
            estateError: estateValidation.error,
            heirs: { ...AppState.heirs },
          };
        },

        /**
         * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –Ω–∞—Å–ª–µ–¥–Ω–∏–∫
         * @returns {boolean}
         */
        hasAnyHeir() {
          const h = AppState.heirs;
          return (
            h.husband ||
            h.wife ||
            h.sons > 0 ||
            h.daughters > 0 ||
            h.grandsonsFromSon > 0 ||
            h.granddaughtersFromSon > 0 ||
            h.father ||
            h.mother ||
            h.paternalGrandfather ||
            h.paternalGrandmother ||
            h.maternalGrandmother ||
            h.fullBrothers > 0 ||
            h.fullSisters > 0 ||
            h.paternalBrothers > 0 ||
            h.paternalSisters > 0 ||
            h.maternalBrothers > 0 ||
            h.maternalSisters > 0
          );
        },
      };

      // ========================================
      // Blocking Controller (UI –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
      // ========================================
      const BlockingController = {
        /**
         * –ú–∞–ø–ø–∏–Ω–≥ —Ç–∏–ø–æ–≤ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤ –Ω–∞ DOM —ç–ª–µ–º–µ–Ω—Ç—ã
         */
        fieldMapping: {
          paternalGrandfather: {
            input: () => DOM.paternalGrandfather,
            hint: () => DOM.grandfatherBlocked,
          },
          paternalGrandmother: {
            input: () => DOM.paternalGrandmother,
            hint: () => DOM.paternalGrandmotherBlocked,
          },
          grandsonsFromSon: {
            input: () => DOM.grandsonsFromSon,
            hint: () => DOM.grandsonsBlocked,
          },
          granddaughtersFromSon: {
            input: () => DOM.granddaughtersFromSon,
            hint: () => DOM.granddaughtersBlocked,
          },
          fullBrothers: {
            input: () => DOM.fullBrothers,
            hint: () => DOM.fullBrothersBlocked,
          },
          fullSisters: {
            input: () => DOM.fullSisters,
            hint: () => DOM.fullSistersBlocked,
          },
          paternalBrothers: {
            input: () => DOM.paternalBrothers,
            hint: () => DOM.paternalBrothersBlocked,
          },
          paternalSisters: {
            input: () => DOM.paternalSisters,
            hint: () => DOM.paternalSistersBlocked,
          },
          maternalBrothers: {
            input: () => DOM.maternalBrothers,
            hint: () => DOM.maternalBrothersBlocked,
          },
          maternalSisters: {
            input: () => DOM.maternalSisters,
            hint: () => DOM.maternalSistersBlocked,
          },
        },

        /**
         * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤—Å–µ—Ö –ø–æ–ª–µ–π –≤ UI
         * –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ –ø–æ–ª—è, –≤–ª–∏—è—é—â–µ–≥–æ –Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
         */
        updateAllBlockings() {
          const blockings = getAllBlockings(AppState.heirs);

          for (const [heirType, blocking] of Object.entries(blockings)) {
            this.updateFieldBlocking(heirType, blocking);
          }
        },

        /**
         * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—è
         * @param {string} heirType - —Ç–∏–ø –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
         * @param {object} blocking - { blocked: boolean, reason: string | null }
         */
        updateFieldBlocking(heirType, blocking) {
          const mapping = this.fieldMapping[heirType];
          if (!mapping) return;

          const input = mapping.input();
          const hint = mapping.hint();

          if (!input) return;

          if (blocking.blocked) {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª–µ
            input.disabled = true;

            // –î–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤ —Å–Ω–∏–º–∞–µ–º –≥–∞–ª–æ—á–∫—É
            if (input.type === "checkbox") {
              input.checked = false;
              // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
              this.updateStateForBlockedCheckbox(heirType);
            } else {
              // –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –ø–æ–ª–µ–π –æ–±–Ω—É–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
              input.value = 0;
              // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
              this.updateStateForBlockedNumber(heirType);
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ (—Å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π)
            if (hint) {
              const reasonKey = blocking.reason;
              hint.textContent = reasonKey
                ? I18n.t(reasonKey)
                : I18n.t("blocking.byFather");
              hint.style.display = "inline";
            }
          } else {
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–ª–µ
            input.disabled = false;

            // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
            if (hint) {
              hint.textContent = "";
              hint.style.display = "none";
            }
          }
        },

        /**
         * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —á–µ–∫–±–æ–∫—Å–∞
         * @param {string} heirType - —Ç–∏–ø –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
         */
        updateStateForBlockedCheckbox(heirType) {
          const stateMapping = {
            paternalGrandfather: "paternalGrandfather",
            paternalGrandmother: "paternalGrandmother",
          };

          const stateKey = stateMapping[heirType];
          if (stateKey) {
            AppState.heirs[stateKey] = false;
          }
        },

        /**
         * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —á–∏—Å–ª–æ–≤–æ–≥–æ –ø–æ–ª—è
         * @param {string} heirType - —Ç–∏–ø –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
         */
        updateStateForBlockedNumber(heirType) {
          const stateMapping = {
            grandsonsFromSon: "grandsonsFromSon",
            granddaughtersFromSon: "granddaughtersFromSon",
            fullBrothers: "fullBrothers",
            fullSisters: "fullSisters",
            paternalBrothers: "paternalBrothers",
            paternalSisters: "paternalSisters",
            maternalBrothers: "maternalBrothers",
            maternalSisters: "maternalSisters",
          };

          const stateKey = stateMapping[heirType];
          if (stateKey) {
            AppState.heirs[stateKey] = 0;
          }
        },
      };

      // ========================================
      // Results Controller
      // ========================================
      const ResultsController = {
        /**
         * DOM —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
         */
        elements: {
          resultsSection: document.getElementById("results-section"),
          specialNotices: document.getElementById("special-notices"),
          resultsTable: document.getElementById("results-table"),
          resultsBody: document.getElementById("results-body"),
          resultsCards: document.getElementById("results-cards"),
          remainderPanel: document.getElementById("remainder-panel"),
          remainderPercentage: document.getElementById("remainder-percentage"),
          remainderAmount: document.getElementById("remainder-amount"),
          remainderDestinationInputs: document.querySelectorAll(
            'input[name="remainder-destination"]'
          ),
          totalPercentage: document.getElementById("total-percentage"),
          totalAmount: document.getElementById("total-amount"),
          printBtn: document.getElementById("print-btn"),
          recalculateBtn: document.getElementById("recalculate-btn"),
        },

        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
         */
        init() {
          this.bindEvents();
        },

        /**
         * –ü—Ä–∏–≤—è–∑–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
         */
        bindEvents() {
          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–µ—á–∞—Ç–∏
          if (this.elements.printBtn) {
            this.elements.printBtn.addEventListener("click", () => {
              this.handlePrint();
            });
          }

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –Ω–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
          if (this.elements.recalculateBtn) {
            this.elements.recalculateBtn.addEventListener("click", () => {
              this.handleRecalculate();
            });
          }

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–∞
          if (this.elements.remainderDestinationInputs?.length) {
            this.elements.remainderDestinationInputs.forEach((input) => {
              input.addEventListener("change", (event) => {
                const { value } = event.target;
                this.handleRemainderDestinationChange(value);
              });
            });
          }
        },

        /**
         * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞
         * @param {object} results - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞
         */
        displayResults(results) {
          if (!results || !results.heirs) {
            console.error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞");
            return;
          }

          // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
          AppState.results = results;

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
          this.showResultsSection();

          // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—Å–æ–±—ã—Ö —Å–ª—É—á–∞—è—Ö
          this.displaySpecialNotices(results);

          // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
          this.populateResultsTable(results);

          // –ó–∞–ø–æ–ª–Ω—è–µ–º –º–æ–±–∏–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
          this.populateResultsCards(results);

          // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ—Å—Ç–∞—Ç–æ–∫
          this.renderRemainder(results);

          // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Ç–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
          this.updateTotals(results);
        },

        /**
         * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–µ–∫—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
         */
        showResultsSection() {
          if (this.elements.resultsSection) {
            this.elements.resultsSection.classList.remove("hidden");

            // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –¥–æ–±–∞–≤–ª—è–µ–º –ø–ª–∞–≤–Ω—É—é –∞–Ω–∏–º–∞—Ü–∏—é
            if (MobileUtils.isMobile()) {
              this.elements.resultsSection.style.opacity = "0";
              this.elements.resultsSection.style.transform = "translateY(20px)";

              setTimeout(() => {
                this.elements.resultsSection.style.transition =
                  "opacity 0.4s ease, transform 0.4s ease";
                this.elements.resultsSection.style.opacity = "1";
                this.elements.resultsSection.style.transform = "translateY(0)";
              }, 100);
            }

            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Å —É—á–µ—Ç–æ–º –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            setTimeout(
              () => {
                this.elements.resultsSection.scrollIntoView({
                  behavior: "smooth",
                  block: MobileUtils.isMobile() ? "start" : "center",
                });
              },
              MobileUtils.isMobile() ? 200 : 0
            );
          }
        },

        /**
         * –°–∫—Ä—ã–≤–∞–µ—Ç —Å–µ–∫—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
         */
        hideResultsSection() {
          if (this.elements.resultsSection) {
            this.elements.resultsSection.classList.add("hidden");
          }
        },

        /**
         * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—Å–æ–±—ã—Ö —Å–ª—É—á–∞—è—Ö
         * @param {object} results - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞
         */
        displaySpecialNotices(results) {
          if (!this.elements.specialNotices) return;

          let noticesHtml = "";

          // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∞–ª—å-–ê–≤–ª—å
          if (results.awlApplied) {
            noticesHtml += `
              <div class="notice notice--warning">
                <span class="notice__icon">‚ö†Ô∏è</span>
                <div>
                  <strong>${I18n.t("notices.awlTitle")}</strong>
                  <p>${I18n.t("notices.awlDescription")}</p>
                </div>
              </div>
            `;
          }

          // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∞—Ä-–†–∞–¥–¥
          if (results.raddApplied) {
            const recipients =
              results.raddRecipients?.join(", ") ||
              I18n.t("heirs.heirs") ||
              "heirs";
            noticesHtml += `
              <div class="notice notice--info">
                <span class="notice__icon">‚ÑπÔ∏è</span>
                <div>
                  <strong>${I18n.t("notices.raddTitle")}</strong>
                  <p>${I18n.t("notices.raddDescription", { recipients })}</p>
                </div>
              </div>
            `;
          }

          // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –æ—Å—Ç–∞—Ç–∫–∞ –º–µ–∂–¥—É –∞—Å–∞–±–∞
          if (results.asabaApplied) {
            const asabaRecipients =
              results.asabaRecipients?.join(", ") ||
              I18n.t("heirs.heirs") ||
              "asaba heirs";
            noticesHtml += `
              <div class="notice notice--info">
                <span class="notice__icon">üìú</span>
                <div>
                  <strong>${I18n.t("notices.asabaTitle")}</strong>
                  <p>${I18n.t("notices.asabaDescription", {
                    recipients: asabaRecipients,
                  })}</p>
                </div>
              </div>
            `;
          }

          // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –∞–ª—å-–£–º–∞—Ä–∏–π—è—Ç–∞–π–Ω
          if (results.umariyyatanApplied) {
            const caseDescription =
              results.umariyyatanCase === 1
                ? "–º—É–∂ –∏ –æ–±–∞ —Ä–æ–¥–∏—Ç–µ–ª—è"
                : "–∂–µ–Ω–∞ –∏ –æ–±–∞ —Ä–æ–¥–∏—Ç–µ–ª—è";
            noticesHtml += `
              <div class="notice notice--info">
                <span class="notice__icon">üìö</span>
                <div>
                  <strong>–ü—Ä–∏–º–µ–Ω–µ–Ω —Å–ª—É—á–∞–π –∞–ª—å-–£–º–∞—Ä–∏–π—è—Ç–∞–π–Ω</strong>
                  <p>–û—Å–æ–±—ã–π —Å–ª—É—á–∞–π –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è: ${caseDescription}. –ú–∞—Ç—å –ø–æ–ª—É—á–∞–µ—Ç 1/3 –æ—Ç –æ—Å—Ç–∞—Ç–∫–∞ –ø–æ—Å–ª–µ –¥–æ–ª–∏ —Å—É–ø—Ä—É–≥–∞.</p>
                </div>
              </div>
            `;
          }

          this.elements.specialNotices.innerHTML = noticesHtml;
        },

        /**
         * –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
         * @param {object} results - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞
         */
        populateResultsTable(results) {
          if (!this.elements.resultsBody) return;

          let tableHtml = "";

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤ —Å –¥–æ–ª–µ–π > 0 –∏–ª–∏ –Ω–µ–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
          const displayHeirs = results.heirs.filter(
            (heir) => !heir.blocked || heir.finalFraction.toDecimal() > 0
          );

          displayHeirs.forEach((heir) => {
            const percentage = (heir.percentage || 0).toFixed(2);
            const amount = this.formatAmount(heir.amount || 0);
            const fraction = heir.finalFraction
              ? heir.finalFraction.simplify().toString()
              : "0";

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∏–ª—å —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
            const rowClass = heir.blocked ? "blocked-heir" : "";
            const blockedText = heir.blocked ? " (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)" : "";

            tableHtml += `
              <tr class="${rowClass}">
                <td><strong>${heir.name}${blockedText}</strong></td>
                <td>${heir.relation || "‚Äî"}</td>
                <td>${fraction}</td>
                <td>${percentage}%</td>
                <td>${amount}</td>
                <td class="dalil-cell">${heir.dalil || "‚Äî"}</td>
              </tr>
            `;

            // –ï—Å–ª–∏ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
            if (heir.blocked && heir.blockedBy) {
              tableHtml += `
                <tr class="blocking-info">
                  <td colspan="6">
                    <small class="blocked-hint">‚Ü≥ ${heir.blockedBy}</small>
                  </td>
                </tr>
              `;
            }
          });

          this.elements.resultsBody.innerHTML = tableHtml;
        },

        /**
         * –ó–∞–ø–æ–ª–Ω—è–µ—Ç –º–æ–±–∏–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
         * @param {object} results - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞
         */
        populateResultsCards(results) {
          if (!this.elements.resultsCards) return;

          let cardsHtml = "";

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤ —Å –¥–æ–ª–µ–π > 0 –∏–ª–∏ –Ω–µ–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
          const displayHeirs = results.heirs.filter(
            (heir) => !heir.blocked || heir.finalFraction.toDecimal() > 0
          );

          displayHeirs.forEach((heir) => {
            const percentage = (heir.percentage || 0).toFixed(2);
            const amount = this.formatAmount(heir.amount || 0);
            const fraction = heir.finalFraction
              ? heir.finalFraction.simplify().toString()
              : "0";

            const blockedClass = heir.blocked ? "blocked-heir" : "";
            const blockedText = heir.blocked ? " (–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω)" : "";

            cardsHtml += `
              <div class="results-card ${blockedClass}">
                <div class="results-card__header">
                  <span class="results-card__name">${
                    heir.name
                  }${blockedText}</span>
                  <span class="results-card__amount">${amount}</span>
                </div>
                <div class="results-card__details">
                  <div class="results-card__detail">
                    <span class="results-card__label">–û—Ç–Ω–æ—à–µ–Ω–∏–µ:</span>
                    <span>${heir.relation || "‚Äî"}</span>
                  </div>
                  <div class="results-card__detail">
                    <span class="results-card__label">–î–æ–ª—è:</span>
                    <span>${fraction}</span>
                  </div>
                  <div class="results-card__detail">
                    <span class="results-card__label">–ü—Ä–æ—Ü–µ–Ω—Ç:</span>
                    <span>${percentage}%</span>
                  </div>
                </div>
                ${
                  heir.dalil
                    ? `
                  <div class="results-card__dalil">
                    <strong>–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:</strong> ${heir.dalil}
                  </div>
                `
                    : ""
                }
                ${
                  heir.blocked && heir.blockedBy
                    ? `
                  <div class="results-card__blocking">
                    <small class="blocked-hint">${heir.blockedBy}</small>
                  </div>
                `
                    : ""
                }
              </div>
            `;
          });

          // –î–æ–±–∞–≤–ª—è–µ–º –∏—Ç–æ–≥–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É
          const totalPercentage = results.heirs
            .filter((heir) => !heir.blocked)
            .reduce((sum, heir) => sum + (heir.percentage || 0), 0);

          const totalAmount = results.heirs
            .filter((heir) => !heir.blocked)
            .reduce((sum, heir) => sum + (heir.amount || 0), 0);

          const is100Percent = Math.abs(totalPercentage - 100) < 0.01;
          const remainderPercentage = results.remainder?.percentage || 0;
          const remainderAmount = results.remainder?.amount || 0;
          const hasRemainder =
            remainderPercentage > 0.01 || remainderAmount > 0;

          let indicator;
          let totalClass;
          if (hasRemainder) {
            indicator = " ‚ÑπÔ∏è";
            totalClass = "total-warning";
          } else if (is100Percent) {
            indicator = " ‚úÖ";
            totalClass = "total-valid";
          } else {
            indicator = " ‚ö†Ô∏è";
            totalClass = "total-warning";
          }

          const remainderSuffix = hasRemainder
            ? ` + –æ—Å—Ç–∞—Ç–æ–∫ ${remainderPercentage.toFixed(2)}%`
            : "";

          cardsHtml += `
            <div class="results-card results-card--total">
              <div class="results-card__header">
                <span class="results-card__name"><strong>–ò—Ç–æ–≥–æ</strong></span>
                <span class="results-card__amount"><strong>${this.formatAmount(
                  totalAmount
                )}</strong></span>
              </div>
              <div class="results-card__details">
                <div class="results-card__detail">
                  <span class="results-card__label">–û–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç:</span>
                  <span class="${totalClass}"><strong>${totalPercentage.toFixed(
            2
          )}%${indicator}${remainderSuffix}</strong></span>
                </div>
              </div>
            </div>
          `;

          if (hasRemainder) {
            cardsHtml += `
              <div class="results-card results-card--remainder">
                <div class="results-card__header">
                  <span class="results-card__name"><strong>–û—Å—Ç–∞—Ç–æ–∫</strong></span>
                  <span class="results-card__amount"><strong>${this.formatAmount(
                    remainderAmount
                  )}</strong></span>
                </div>
                <div class="results-card__details">
                  <div class="results-card__detail">
                    <span class="results-card__label">–ü—Ä–æ—Ü–µ–Ω—Ç:</span>
                    <span>${remainderPercentage.toFixed(2)}%</span>
                  </div>
                  <div class="results-card__detail">
                    <span class="results-card__label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</span>
                    <span>–ö–∞–∑–Ω–∞/–°–∞–¥–∞–∫—ä–∞</span>
                  </div>
                </div>
              </div>
            `;
          }

          this.elements.resultsCards.innerHTML = cardsHtml;
        },

        /**
         * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–ª–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –æ—Å—Ç–∞—Ç–∫–µ
         * @param {object} results - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞
         */
        renderRemainder(results) {
          if (!this.elements.remainderPanel) return;

          const remainder = results.remainder || {
            percentage: 0,
            amount: 0,
            destination: AppState.remainderDestination,
          };

          // –£—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π
          const hasRemainder =
            (remainder.percentage || 0) > 0.01 && (remainder.amount || 0) > 1;

          this.elements.remainderPanel.classList.toggle(
            "hidden",
            !hasRemainder
          );

          if (!hasRemainder) return;

          if (this.elements.remainderPercentage) {
            this.elements.remainderPercentage.textContent = `${remainder.percentage.toFixed(
              2
            )}%`;
          }

          if (this.elements.remainderAmount) {
            this.elements.remainderAmount.textContent = this.formatAmount(
              remainder.amount || 0
            );
          }

          this.syncRemainderDestination(remainder.destination);
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–º–µ–Ω—ã –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–∞
         * @param {string} destination - treasury | charity
         */
        handleRemainderDestinationChange(destination) {
          if (!destination) return;

          AppState.remainderDestination = destination;

          if (AppState.results?.remainder) {
            AppState.results.remainder.destination = destination;
            this.renderRemainder(AppState.results);
            this.updateTotals(AppState.results);
          }
        },

        /**
         * –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–∫–∏ –æ—Å—Ç–∞—Ç–∫–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
         * @param {string} destination
         */
        syncRemainderDestination(destination) {
          if (!this.elements.remainderDestinationInputs?.length) return;
          this.elements.remainderDestinationInputs.forEach((input) => {
            input.checked = input.value === destination;
          });
        },

        /**
         * –û–±–Ω–æ–≤–ª—è–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
         * @param {object} results - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞
         */
        updateTotals(results) {
          // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 100%)
          const totalPercentage = results.heirs
            .filter((heir) => !heir.blocked)
            .reduce((sum, heir) => sum + (heir.percentage || 0), 0);

          const remainderPercentage = results.remainder?.percentage || 0;
          const hasRemainder = remainderPercentage > 0.01;

          // –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â—É—é —Å—É–º–º—É
          const totalAmount = results.heirs
            .filter((heir) => !heir.blocked)
            .reduce((sum, heir) => sum + (heir.amount || 0), 0);

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Ä–∞–≤–Ω–∞ –ª–∏ —Å—É–º–º–∞ –¥–æ–ª–µ–π 100%
          const is100Percent = Math.abs(totalPercentage - 100) < 0.01;

          // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ —Å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º
          if (this.elements.totalPercentage) {
            const percentageText = `${totalPercentage.toFixed(2)}%`;
            let indicator;
            let totalClass;
            if (hasRemainder) {
              indicator = " ‚ÑπÔ∏è";
              totalClass = "total-warning";
            } else if (is100Percent) {
              indicator = " ‚úÖ";
              totalClass = "total-valid";
            } else {
              indicator = " ‚ö†Ô∏è";
              totalClass = "total-warning";
            }
            const remainderText = hasRemainder
              ? ` (–æ—Å—Ç–∞—Ç–æ–∫: ${remainderPercentage.toFixed(2)}%)`
              : "";
            this.elements.totalPercentage.innerHTML = `${percentageText}${indicator}${remainderText}`;

            // –î–æ–±–∞–≤–ª—è–µ–º CSS –∫–ª–∞—Å—Å –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
            this.elements.totalPercentage.className = totalClass;
          }

          if (this.elements.totalAmount) {
            this.elements.totalAmount.textContent =
              this.formatAmount(totalAmount);
          }
        },

        /**
         * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–µ–Ω–µ–∂–Ω—É—é —Å—É–º–º—É
         * @param {number} amount - —Å—É–º–º–∞
         * @returns {string} - –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—É–º–º–∞
         */
        formatAmount(amount) {
          if (amount === 0) return "0";
          return new Intl.NumberFormat("ru-RU", {
            minimumFractionDigits: 0,
            maximumFractionDigits: 2,
          }).format(amount);
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—á–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
         */
        handlePrint() {
          // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞—Ç—É –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ø–µ—á–∞—Ç–∏
          const printDate = new Date().toLocaleDateString("ru-RU", {
            year: "numeric",
            month: "long",
            day: "numeric",
          });
          const originalTitle = document.title;
          document.title = `${originalTitle} - ${printDate}`;

          // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å –¥–∞—Ç–æ–π –¥–ª—è –ø–µ—á–∞—Ç–∏
          this.addPrintDateElement(printDate);

          // –ü–µ—á–∞—Ç–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
          globalThis.print();

          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —É–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
          document.title = originalTitle;
          this.removePrintDateElement();
        },

        /**
         * –î–æ–±–∞–≤–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç —Å –¥–∞—Ç–æ–π –¥–ª—è –ø–µ—á–∞—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏
         * @param {string} printDate - –¥–∞—Ç–∞ –ø–µ—á–∞—Ç–∏
         */
        addPrintDateElement(printDate) {
          // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å –¥–∞—Ç–æ–π
          const printDateElement = document.createElement("div");
          printDateElement.id = "print-date";
          printDateElement.className = "print-only";
          printDateElement.innerHTML = `
            <div style="text-align: center; margin: 20px 0; font-size: 14px; color: #666;">
              <strong>–î–∞—Ç–∞ —Ä–∞—Å—á–µ—Ç–∞:</strong> ${printDate}
            </div>
          `;

          // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
          const resultsSection = this.elements.resultsSection;
          if (resultsSection) {
            resultsSection.insertBefore(
              printDateElement,
              resultsSection.firstChild
            );
          }
        },

        /**
         * –£–¥–∞–ª—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å –¥–∞—Ç–æ–π
         */
        removePrintDateElement() {
          const printDateElement = document.getElementById("print-date");
          if (printDateElement) {
            printDateElement.remove();
          }
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–æ–≤–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
         */
        handleRecalculate() {
          // –°–∫—Ä—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
          this.hideResultsSection();

          // –û—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
          AppState.results = null;
          AppState.appliedRules = {
            awl: false,
            radd: false,
            umariyyatan: false,
          };

          // –û—á–∏—â–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
          this.clearResults();

          // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ñ–æ—Ä–º–µ
          if (DOM.calculatorMain) {
            DOM.calculatorMain.scrollIntoView({
              behavior: "smooth",
              block: "start",
            });
          }
        },

        /**
         * –û—á–∏—â–∞–µ—Ç –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
         */
        clearResults() {
          if (this.elements.specialNotices) {
            this.elements.specialNotices.innerHTML = "";
          }
          if (this.elements.resultsBody) {
            this.elements.resultsBody.innerHTML = "";
          }
          if (this.elements.resultsCards) {
            this.elements.resultsCards.innerHTML = "";
          }
          if (this.elements.totalPercentage) {
            this.elements.totalPercentage.textContent = "0%";
          }
          if (this.elements.totalAmount) {
            this.elements.totalAmount.textContent = "0";
          }
          if (this.elements.remainderPanel) {
            this.elements.remainderPanel.classList.add("hidden");
          }
          if (this.elements.remainderAmount) {
            this.elements.remainderAmount.textContent = "0";
          }
          if (this.elements.remainderPercentage) {
            this.elements.remainderPercentage.textContent = "0%";
          }
          this.syncRemainderDestination(AppState.remainderDestination);
        },
      };

      // ========================================
      // Calculation Controller
      // ========================================
      const CalculationController = {
        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —Ä–∞—Å—á–µ—Ç–æ–≤
         */
        init() {
          this.bindEvents();
        },

        /**
         * –ü—Ä–∏–≤—è–∑–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
         */
        bindEvents() {
          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —Ä–∞—Å—á–µ—Ç–∞
          if (DOM.calculateBtn) {
            DOM.calculateBtn.addEventListener("click", () => {
              this.handleCalculate();
            });
          }
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–∞—Å—á–µ—Ç–∞ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞
         */
        handleCalculate() {
          // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
          const formData = FormController.getFormData();

          // –û–¢–õ–ê–î–ö–ê: –í—ã–≤–æ–¥–∏–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –≤ –∫–æ–Ω—Å–æ–ª—å
          console.log("=== –û–¢–õ–ê–î–ö–ê: –î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã ===");
          console.log("formData.heirs:", formData.heirs);
          console.log("AppState.heirs:", AppState.heirs);

          // –í–∞–ª–∏–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
          if (!this.validateFormData(formData)) {
            return;
          }

          try {
            // –í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞—Å—á–µ—Ç (–ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞)
            const results = this.calculateInheritance(formData);

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            ResultsController.displayResults(results);
          } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞:", error);
            alert(
              "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–≤–µ–¥–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ."
            );
          }
        },

        /**
         * –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –ø–µ—Ä–µ–¥ —Ä–∞—Å—á–µ—Ç–æ–º
         * @param {object} formData - –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
         * @returns {boolean} - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
         */
        validateFormData(formData) {
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É–º–º—É –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞
          if (!formData.estateValid) {
            FormController.showEstateError(formData.estateError);
            DOM.estateAmount?.focus();
            return false;
          }

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
          if (!FormController.hasAnyHeir()) {
            alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞.");
            return false;
          }

          return true;
        },

        /**
         * –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞—Å—á–µ—Ç –Ω–∞—Å–ª–µ–¥—Å—Ç–≤–∞ (–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞)
         * @param {object} formData - –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
         * @returns {object} - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞
         */
        calculateInheritance(formData) {
          const results = {
            heirs: [],
            totalDistributed: 100,
            awlApplied: false,
            awlRatio: null,
            raddApplied: false,
            raddRecipients: [],
            umariyyatanApplied: false,
            umariyyatanCase: null,
            remainder: {
              percentage: 0,
              amount: 0,
              destination: AppState.remainderDestination || "treasury",
            },
          };

          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ª–∏—á–∏–µ –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
          const hasDescendants =
            formData.heirs.sons > 0 ||
            formData.heirs.daughters > 0 ||
            formData.heirs.grandsonsFromSon > 0 ||
            formData.heirs.granddaughtersFromSon > 0;

          const hasFather =
            formData.heirs.father || formData.heirs.paternalGrandfather;
          const hasMother = formData.heirs.mother;

          const hasFullSiblings =
            formData.heirs.fullBrothers > 0 || formData.heirs.fullSisters > 0;
          const hasPaternalSiblings =
            formData.heirs.paternalBrothers > 0 ||
            formData.heirs.paternalSisters > 0;
          const hasDistantAsabaCandidates =
            formData.heirs.nephewsFullBrothers > 0 ||
            formData.heirs.nephewsPaternalBrothers > 0 ||
            formData.heirs.unclesFull > 0 ||
            formData.heirs.unclesPaternal > 0;
          const hasCloserAgnaticHeirs =
            formData.heirs.sons > 0 ||
            formData.heirs.grandsonsFromSon > 0 ||
            formData.heirs.father ||
            formData.heirs.paternalGrandfather ||
            hasFullSiblings ||
            hasPaternalSiblings;

          // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–ª–µ–π (Fara'id) - –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
          // let fixedShares = new Fraction(0, 1);

          // 1. –°–£–ü–†–£–ì–ò (Zawj/Zawja)
          if (formData.heirs.husband) {
            const husbandFraction = hasDescendants
              ? new Fraction(1, 4)
              : new Fraction(1, 2);
            results.heirs.push({
              heirType: "husband",
              name: getHeirName("husband"),
              relation: getHeirRelation("spouseM"),
              baseFraction: husbandFraction,
              finalFraction: husbandFraction,
              percentage: husbandFraction.toDecimal() * 100,
              amount: formData.totalEstate * husbandFraction.toDecimal(),
              dalil: getDalil("quran412"),
              blocked: false,
              blockedBy: null,
            });
          }

          if (formData.heirs.wife) {
            const wifeFraction = hasDescendants
              ? new Fraction(1, 8)
              : new Fraction(1, 4);
            results.heirs.push({
              heirType: "wife",
              name: getHeirName("wife", formData.heirs.wifeCount),
              relation: getHeirRelation("spouse"),
              baseFraction: wifeFraction,
              finalFraction: wifeFraction,
              percentage: wifeFraction.toDecimal() * 100,
              amount: formData.totalEstate * wifeFraction.toDecimal(),
              dalil: getDalil("quran412"),
              blocked: false,
              blockedBy: null,
            });
          }

          // 2. –ü–†–ï–î–ö–ò (Usul)
          if (formData.heirs.father) {
            const fatherFraction = new Fraction(1, 6);
            results.heirs.push({
              name: getHeirName("father"),
              relation: getHeirRelation("parent"),
              baseFraction: fatherFraction,
              finalFraction: fatherFraction,
              percentage: fatherFraction.toDecimal() * 100,
              amount: formData.totalEstate * fatherFraction.toDecimal(),
              dalil: getDalil("quran411"),
              blocked: false,
              blockedBy: null,
            });
          }

          if (formData.heirs.paternalGrandfather) {
            if (formData.heirs.father) {
              results.heirs.push({
                name: getHeirName("grandfather"),
                relation: getHeirRelation("parent"),
                baseFraction: new Fraction(0, 1),
                finalFraction: new Fraction(0, 1),
                percentage: 0,
                amount: 0,
                dalil: getDalil("quran411"),
                blocked: true,
                blockedBy: I18n.t("blocking.byFather"),
              });
            } else {
              const grandfatherFraction = new Fraction(1, 6);
              results.heirs.push({
                name: getHeirName("grandfather"),
                relation: getHeirRelation("parent"),
                baseFraction: grandfatherFraction,
                finalFraction: grandfatherFraction,
                percentage: grandfatherFraction.toDecimal() * 100,
                amount: formData.totalEstate * grandfatherFraction.toDecimal(),
                dalil: getDalil("quran411"),
                blocked: false,
                blockedBy: null,
              });
            }
          }

          if (formData.heirs.mother) {
            const motherFraction =
              !hasDescendants && !hasFullSiblings && !hasPaternalSiblings
                ? new Fraction(1, 3)
                : new Fraction(1, 6);

            results.heirs.push({
              name: getHeirName("mother"),
              relation: getHeirRelation("parent"),
              baseFraction: motherFraction,
              finalFraction: motherFraction,
              percentage: motherFraction.toDecimal() * 100,
              amount: formData.totalEstate * motherFraction.toDecimal(),
              dalil: getDalil("quran411"),
              blocked: false,
              blockedBy: null,
            });
          }

          // –ë–∞–±—É—à–∫–∏ –ø–æ–ª—É—á–∞—é—Ç 1/6 –µ—Å–ª–∏ –Ω–µ—Ç –º–∞—Ç–µ—Ä–∏ (–¥–µ–ª—è—Ç –ø–æ—Ä–æ–≤–Ω—É –µ—Å–ª–∏ –æ–±–µ)
          if (
            !hasMother &&
            (formData.heirs.paternalGrandmother ||
              formData.heirs.maternalGrandmother)
          ) {
            const grandmothersCount =
              (formData.heirs.paternalGrandmother ? 1 : 0) +
              (formData.heirs.maternalGrandmother ? 1 : 0);
            const grandmotherFraction = new Fraction(1, 6 * grandmothersCount);

            if (formData.heirs.paternalGrandmother) {
              results.heirs.push({
                name: getHeirName("paternalGrandmother"),
                relation: getHeirRelation("parent"),
                baseFraction: grandmotherFraction,
                finalFraction: grandmotherFraction,
                percentage: grandmotherFraction.toDecimal() * 100,
                amount: formData.totalEstate * grandmotherFraction.toDecimal(),
                dalil: getDalil("quran411"),
                blocked: false,
                blockedBy: null,
              });
            }

            if (formData.heirs.maternalGrandmother) {
              results.heirs.push({
                name: getHeirName("maternalGrandmother"),
                relation: getHeirRelation("parent"),
                baseFraction: grandmotherFraction,
                finalFraction: grandmotherFraction,
                percentage: grandmotherFraction.toDecimal() * 100,
                amount: formData.totalEstate * grandmotherFraction.toDecimal(),
                dalil: getDalil("quran411"),
                blocked: false,
                blockedBy: null,
              });
            }
          } else if (hasMother) {
            // –ë–∞–±—É—à–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –º–∞—Ç–µ—Ä—å—é
            if (formData.heirs.paternalGrandmother) {
              results.heirs.push({
                name: getHeirName("paternalGrandmother"),
                relation: getHeirRelation("parent"),
                baseFraction: new Fraction(0, 1),
                finalFraction: new Fraction(0, 1),
                percentage: 0,
                amount: 0,
                dalil: getDalil("quran411"),
                blocked: true,
                blockedBy: I18n.t("blocking.byMother"),
              });
            }
            if (formData.heirs.maternalGrandmother) {
              results.heirs.push({
                name: getHeirName("maternalGrandmother"),
                relation: getHeirRelation("parent"),
                baseFraction: new Fraction(0, 1),
                finalFraction: new Fraction(0, 1),
                percentage: 0,
                amount: 0,
                dalil: getDalil("quran411"),
                blocked: true,
                blockedBy: I18n.t("blocking.byMother"),
              });
            }
          }

          // 3. –ü–û–¢–û–ú–ö–ò (Furu')
          if (formData.heirs.sons > 0) {
            // –°—ã–Ω–æ–≤—å—è –∏ –¥–æ—á–µ—Ä–∏ –¥–µ–ª—è—Ç –æ—Å—Ç–∞—Ç–æ–∫ –∫–∞–∫ –∞—Å–∞–∞–±–∞ (2:1)
            const remainder = calculateRemainder(formData.heirs);
            const totalUnits =
              formData.heirs.sons * 2 + formData.heirs.daughters;
            const unitFraction =
              totalUnits > 0
                ? remainder.divide(new Fraction(totalUnits, 1))
                : new Fraction(0, 1);

            // –î–æ–ª—è –æ–¥–Ω–æ–≥–æ —Å—ã–Ω–∞ (2 –µ–¥–∏–Ω–∏—Ü—ã)
            const perSonFraction = unitFraction.multiply(new Fraction(2, 1));
            // –û–±—â–∞—è –¥–æ–ª—è –≤—Å–µ—Ö —Å—ã–Ω–æ–≤–µ–π
            const totalSonsFraction = perSonFraction.multiply(
              new Fraction(formData.heirs.sons, 1)
            );
            results.heirs.push({
              name: getHeirName("son", formData.heirs.sons),
              relation: getHeirRelation("child"),
              baseFraction: totalSonsFraction,
              finalFraction: totalSonsFraction,
              percentage: totalSonsFraction.toDecimal() * 100,
              amount: formData.totalEstate * totalSonsFraction.toDecimal(),
              dalil: getDalil("quran411"),
              blocked: false,
              blockedBy: null,
            });

            if (formData.heirs.daughters > 0) {
              // –î–æ–ª—è –æ–¥–Ω–æ–π –¥–æ—á–µ—Ä–∏ (1 –µ–¥–∏–Ω–∏—Ü–∞)
              const perDaughterFraction = unitFraction;
              // –û–±—â–∞—è –¥–æ–ª—è –≤—Å–µ—Ö –¥–æ—á–µ—Ä–µ–π
              const totalDaughtersFraction = perDaughterFraction.multiply(
                new Fraction(formData.heirs.daughters, 1)
              );
              results.heirs.push({
                name: getHeirName("daughter", formData.heirs.daughters),
                relation: getHeirRelation("child"),
                baseFraction: totalDaughtersFraction,
                finalFraction: totalDaughtersFraction,
                percentage: totalDaughtersFraction.toDecimal() * 100,
                amount:
                  formData.totalEstate * totalDaughtersFraction.toDecimal(),
                dalil: getDalil("quran411"),
                blocked: false,
                blockedBy: null,
              });
            }
          } else if (formData.heirs.daughters > 0) {
            const daughterFraction =
              formData.heirs.daughters === 1
                ? new Fraction(1, 2)
                : new Fraction(2, 3);

            results.heirs.push({
              name: getHeirName("daughter", formData.heirs.daughters),
              relation: getHeirRelation("child"),
              baseFraction: daughterFraction,
              finalFraction: daughterFraction,
              percentage: daughterFraction.toDecimal() * 100,
              amount: formData.totalEstate * daughterFraction.toDecimal(),
              dalil: getDalil("quran411"),
              blocked: false,
              blockedBy: null,
            });
          }

          if (
            formData.heirs.grandsonsFromSon > 0 &&
            formData.heirs.sons === 0
          ) {
            const grandsonShare = 1 / 4; // –ü—Ä–∏–º–µ—Ä–Ω–∞—è –¥–æ–ª—è
            results.heirs.push({
              name: getHeirName(
                "grandsonsFromSon",
                formData.heirs.grandsonsFromSon
              ),
              relation: getHeirRelation("grandchild"),
              baseFraction: new Fraction(1, 4),
              finalFraction: new Fraction(1, 4),
              percentage: grandsonShare * 100,
              amount: formData.totalEstate * grandsonShare,
              dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:11',
              blocked: false,
              blockedBy: null,
            });
          } else if (
            formData.heirs.grandsonsFromSon > 0 &&
            formData.heirs.sons > 0
          ) {
            results.heirs.push({
              name: getHeirName(
                "grandsonsFromSon",
                formData.heirs.grandsonsFromSon
              ),
              relation: getHeirRelation("grandchild"),
              baseFraction: new Fraction(0, 1),
              finalFraction: new Fraction(0, 1),
              percentage: 0,
              amount: 0,
              dalil: getDalil("quran411"),
              blocked: true,
              blockedBy: I18n.t("blocking.bySon"),
            });
          }

          if (
            formData.heirs.granddaughtersFromSon > 0 &&
            formData.heirs.sons === 0
          ) {
            let granddaughterShare;
            let granddaughterFraction;
            if (formData.heirs.daughters === 0) {
              if (formData.heirs.granddaughtersFromSon === 1) {
                granddaughterShare = 1 / 2;
                granddaughterFraction = new Fraction(1, 2);
              } else {
                granddaughterShare = 2 / 3;
                granddaughterFraction = new Fraction(2, 3);
              }
            } else {
              granddaughterShare = 1 / 6;
              granddaughterFraction = new Fraction(1, 6);
            }

            results.heirs.push({
              name: getHeirName(
                "granddaughtersFromSon",
                formData.heirs.granddaughtersFromSon
              ),
              relation: getHeirRelation("grandchild"),
              baseFraction: granddaughterFraction,
              finalFraction: granddaughterFraction,
              percentage: granddaughterShare * 100,
              amount: formData.totalEstate * granddaughterShare,
              dalil: getDalil("quran411"),
              blocked: false,
              blockedBy: null,
            });
          } else if (
            formData.heirs.granddaughtersFromSon > 0 &&
            formData.heirs.sons > 0
          ) {
            results.heirs.push({
              name: getHeirName(
                "granddaughtersFromSon",
                formData.heirs.granddaughtersFromSon
              ),
              relation: getHeirRelation("grandchild"),
              baseFraction: new Fraction(0, 1),
              finalFraction: new Fraction(0, 1),
              percentage: 0,
              amount: 0,
              dalil: getDalil("quran411"),
              blocked: true,
              blockedBy: I18n.t("blocking.bySon"),
            });
          }

          // –ë–†–ê–¢–¨–Ø –ò –°–ï–°–¢–†–´
          // –ë—Ä–∞—Ç—å—è –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¢–û–õ–¨–ö–û —Å—ã–Ω–æ–≤—å—è–º–∏, –≤–Ω—É–∫–∞–º–∏ –æ—Ç —Å—ã–Ω–∞, –æ—Ç—Ü–æ–º –∏–ª–∏ –¥–µ–¥–æ–º
          // –î–æ—á–µ—Ä–∏ –∏ –≤–Ω—É—á–∫–∏ –ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç –±—Ä–∞—Ç—å–µ–≤ ‚Äî –±—Ä–∞—Ç—å—è —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∞—Å–∞–±–∞
          const brothersBlockedBy =
            formData.heirs.sons > 0 || formData.heirs.grandsonsFromSon > 0;

          // –î–ª—è —Å–µ—Å—Ç–µ—Ä –±–µ–∑ –±—Ä–∞—Ç—å–µ–≤ ‚Äî –æ–Ω–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Ç–∞–∫–∂–µ –ø–æ—Ç–æ–º–∫–∞–º–∏-–∂–µ–Ω—â–∏–Ω–∞–º–∏
          // (–∫–æ–≥–¥–∞ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∞—Å–∞–±–∞ –º–∞'–∞ –≥–∞–π—Ä–∏—Ö–∏ —Å –¥–æ—á–µ—Ä—å–º–∏)
          const hasDescendantsForSiblings =
            formData.heirs.sons > 0 ||
            formData.heirs.daughters > 0 ||
            formData.heirs.grandsonsFromSon > 0 ||
            formData.heirs.granddaughtersFromSon > 0;

          // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ª–∏ –±—Ä–∞—Ç –¥–µ–¥–æ–º (–ø–æ –º–Ω–µ–Ω–∏—é –ê–±—É –ë–∞–∫—Ä–∞)
          const brothersBlockedByGrandfather =
            formData.heirs.paternalGrandfather;

          // –ü–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã–µ –±—Ä–∞—Ç—å—è –∏ —Å–µ—Å—Ç—Ä—ã
          if (
            formData.heirs.fullBrothers > 0 &&
            !brothersBlockedBy &&
            !hasFather &&
            !brothersBlockedByGrandfather
          ) {
            // –ë—Ä–∞—Ç—å—è —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∞—Å–∞–±–∞ –∏ –¥–µ–ª—è—Ç –æ—Å—Ç–∞—Ç–æ–∫ –≤–º–µ—Å—Ç–µ —Å —Å–µ—Å—Ç—Ä–∞–º–∏ (2:1)
            const remainder = calculateRemainder(formData.heirs);
            const brotherCount = formData.heirs.fullBrothers;
            const sisterCount = formData.heirs.fullSisters;
            const totalUnits = brotherCount * 2 + sisterCount;
            const unitFraction =
              totalUnits > 0
                ? remainder.divide(new Fraction(totalUnits, 1))
                : new Fraction(0, 1);

            const brotherFraction = unitFraction.multiply(new Fraction(2, 1));
            const brotherTotalFraction = brotherFraction.multiply(
              new Fraction(brotherCount, 1)
            );

            results.heirs.push({
              name: getHeirName("fullBrother", brotherCount),
              relation: getHeirRelation("sibling"),
              baseFraction: brotherTotalFraction,
              finalFraction: brotherTotalFraction,
              percentage: brotherTotalFraction.toDecimal() * 100,
              amount: formData.totalEstate * brotherTotalFraction.toDecimal(),
              dalil: getDalil("quran4176"),
              blocked: false,
              blockedBy: null,
            });

            if (sisterCount > 0) {
              const sisterAsabaFraction = unitFraction.multiply(
                new Fraction(sisterCount, 1)
              );
              results.heirs.push({
                name: getHeirName("fullSister", sisterCount),
                relation: getHeirRelation("sibling"),
                baseFraction: sisterAsabaFraction,
                finalFraction: sisterAsabaFraction,
                percentage: sisterAsabaFraction.toDecimal() * 100,
                amount: formData.totalEstate * sisterAsabaFraction.toDecimal(),
                dalil: getDalil("quran4176"),
                blocked: false,
                blockedBy: null,
              });
            }

            // –ü–æ–º–µ—á–∞–µ–º —á—Ç–æ –æ—Å—Ç–∞—Ç–æ–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω –º–µ–∂–¥—É –∞—Å–∞–±–∞
            results.asabaApplied = true;
            results.asabaRecipients = results.asabaRecipients || [];
            results.asabaRecipients.push(
              getHeirName("fullBrother", brotherCount)
            );
            if (sisterCount > 0) {
              results.asabaRecipients.push(
                getHeirName("fullSister", sisterCount)
              );
            }
          } else if (
            formData.heirs.fullBrothers > 0 &&
            (brothersBlockedBy || hasFather || brothersBlockedByGrandfather)
          ) {
            // –ë—Ä–∞—Ç—å—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
            let blockedByReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è";
            if (formData.heirs.sons > 0) {
              blockedByReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å—ã–Ω–æ–≤—å—è–º–∏";
            } else if (formData.heirs.grandsonsFromSon > 0) {
              blockedByReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –≤–Ω—É–∫–∞–º–∏ –æ—Ç —Å—ã–Ω–∞";
            } else if (hasFather) {
              blockedByReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –æ—Ç—Ü–æ–º";
            } else if (brothersBlockedByGrandfather) {
              blockedByReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –¥–µ–¥–æ–º (–æ—Ç—Ü–æ–º –æ—Ç—Ü–∞)";
            }

            results.heirs.push({
              name:
                formData.heirs.fullBrothers === 1
                  ? "–ë—Ä–∞—Ç (–ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã–π)"
                  : `–ë—Ä–∞—Ç—å—è –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã–µ (${formData.heirs.fullBrothers})`,
              relation: "–ë—Ä–∞—Ç –ø–æ–∫–æ–π–Ω–æ–≥–æ",
              baseFraction: new Fraction(0, 1),
              finalFraction: new Fraction(0, 1),
              percentage: 0,
              amount: 0,
              dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:176',
              blocked: true,
              blockedBy: blockedByReason,
            });
          }

          if (
            formData.heirs.fullSisters > 0 &&
            !hasDescendantsForSiblings &&
            !hasFather &&
            formData.heirs.fullBrothers === 0
          ) {
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ—Å—Ç–∞—Ç–æ–∫ –ø–æ—Å–ª–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–ª–µ–π
            let fixedShares = 0;

            // –ñ–µ–Ω–∞: 1/4
            if (formData.heirs.wife) {
              fixedShares +=
                formData.heirs.sons > 0 || formData.heirs.daughters > 0
                  ? 1 / 8
                  : 1 / 4;
            }

            // –ë–∞–±—É—à–∫–∏: 1/6 –æ–±—â–∞—è –¥–æ–ª—è
            if (
              (formData.heirs.paternalGrandmother ||
                formData.heirs.maternalGrandmother) &&
              !formData.heirs.mother
            ) {
              fixedShares += 1 / 6;
            }

            // –û—Å—Ç–∞—Ç–æ–∫ –¥–ª—è —Å–µ—Å—Ç–µ—Ä
            const remainingShare = 1 - fixedShares;
            const fullSisterShare = remainingShare;
            const fullSisterFraction =
              Fraction.fromDecimal(remainingShare).simplify();

            results.heirs.push({
              name:
                formData.heirs.fullSisters === 1
                  ? "–°–µ—Å—Ç—Ä–∞ (–ø–æ–ª–Ω–æ—Ä–æ–¥–Ω–∞—è)"
                  : `–°–µ—Å—Ç—Ä—ã –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã–µ (${formData.heirs.fullSisters})`,
              relation: "–°–µ—Å—Ç—Ä–∞ –ø–æ–∫–æ–π–Ω–æ–≥–æ",
              baseFraction: fullSisterFraction,
              finalFraction: fullSisterFraction,
              percentage: fullSisterShare * 100,
              amount: formData.totalEstate * fullSisterShare,
              dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:176',
              blocked: false,
              blockedBy: null,
            });
          } else if (
            formData.heirs.fullSisters > 0 &&
            (hasDescendantsForSiblings || hasFather)
          ) {
            // –°—ë—Å—Ç—Ä—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã —Å—ã–Ω–æ–≤—å—è–º–∏/–≤–Ω—É–∫–∞–º–∏ –∏–ª–∏ –æ—Ç—Ü–æ–º
            let sistersBlockedByReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è";
            if (formData.heirs.sons > 0) {
              sistersBlockedByReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å—ã–Ω–æ–≤—å—è–º–∏";
            } else if (formData.heirs.grandsonsFromSon > 0) {
              sistersBlockedByReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –≤–Ω—É–∫–∞–º–∏ –æ—Ç —Å—ã–Ω–∞";
            } else if (hasFather) {
              sistersBlockedByReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –æ—Ç—Ü–æ–º";
            }

            results.heirs.push({
              name:
                formData.heirs.fullSisters === 1
                  ? "–°–µ—Å—Ç—Ä–∞ (–ø–æ–ª–Ω–æ—Ä–æ–¥–Ω–∞—è)"
                  : `–°–µ—Å—Ç—Ä—ã –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã–µ (${formData.heirs.fullSisters})`,
              relation: "–°–µ—Å—Ç—Ä–∞ –ø–æ–∫–æ–π–Ω–æ–≥–æ",
              baseFraction: new Fraction(0, 1),
              finalFraction: new Fraction(0, 1),
              percentage: 0,
              amount: 0,
              dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:176',
              blocked: true,
              blockedBy: sistersBlockedByReason,
            });
          }

          // –ï–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–µ –±—Ä–∞—Ç—å—è –∏ —Å–µ—Å—Ç—Ä—ã (–ø–æ –æ—Ç—Ü—É)

          if (
            formData.heirs.paternalBrothers > 0 &&
            !hasDescendantsForSiblings &&
            !hasFather &&
            !hasFullSiblings
          ) {
            const paternalBrotherShare = 1 / 5; // –ü—Ä–∏–º–µ—Ä–Ω–∞—è –¥–æ–ª—è
            results.heirs.push({
              name:
                formData.heirs.paternalBrothers === 1
                  ? "–ë—Ä–∞—Ç (–µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–π)"
                  : `–ë—Ä–∞—Ç—å—è –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–µ (${formData.heirs.paternalBrothers})`,
              relation: "–ë—Ä–∞—Ç –ø–æ–∫–æ–π–Ω–æ–≥–æ",
              baseFraction: new Fraction(1, 5),
              finalFraction: new Fraction(1, 5),
              percentage: paternalBrotherShare * 100,
              amount: formData.totalEstate * paternalBrotherShare,
              dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:176',
              blocked: false,
              blockedBy: null,
            });
          } else if (formData.heirs.paternalBrothers > 0) {
            let blockReason = "";
            if (hasDescendantsForSiblings)
              blockReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø–æ—Ç–æ–º–∫–∞–º–∏";
            else if (hasFather) blockReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –æ—Ç—Ü–æ–º";
            else if (hasFullSiblings)
              blockReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã–º–∏ –±—Ä–∞—Ç—å—è–º–∏/—Å–µ—Å—Ç—Ä–∞–º–∏";

            results.heirs.push({
              name:
                formData.heirs.paternalBrothers === 1
                  ? "–ë—Ä–∞—Ç (–µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–π)"
                  : `–ë—Ä–∞—Ç—å—è –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–µ (${formData.heirs.paternalBrothers})`,
              relation: "–ë—Ä–∞—Ç –ø–æ–∫–æ–π–Ω–æ–≥–æ",
              baseFraction: new Fraction(0, 1),
              finalFraction: new Fraction(0, 1),
              percentage: 0,
              amount: 0,
              dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:176',
              blocked: true,
              blockedBy: blockReason,
            });
          }

          if (
            formData.heirs.paternalSisters > 0 &&
            !hasDescendantsForSiblings &&
            !hasFather &&
            !hasFullSiblings
          ) {
            let paternalSisterShare;
            let paternalSisterFraction;
            if (formData.heirs.paternalBrothers > 0) {
              paternalSisterShare = 1 / 10;
              paternalSisterFraction = new Fraction(1, 10);
            } else if (formData.heirs.paternalSisters === 1) {
              paternalSisterShare = 1 / 2;
              paternalSisterFraction = new Fraction(1, 2);
            } else {
              paternalSisterShare = 2 / 3;
              paternalSisterFraction = new Fraction(2, 3);
            }

            results.heirs.push({
              name:
                formData.heirs.paternalSisters === 1
                  ? "–°–µ—Å—Ç—Ä–∞ (–µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω–∞—è)"
                  : `–°–µ—Å—Ç—Ä—ã –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–µ (${formData.heirs.paternalSisters})`,
              relation: "–°–µ—Å—Ç—Ä–∞ –ø–æ–∫–æ–π–Ω–æ–≥–æ",
              baseFraction: paternalSisterFraction,
              finalFraction: paternalSisterFraction,
              percentage: paternalSisterShare * 100,
              amount: formData.totalEstate * paternalSisterShare,
              dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:176',
              blocked: false,
              blockedBy: null,
            });
          } else if (formData.heirs.paternalSisters > 0) {
            let blockReason = "";
            if (hasDescendantsForSiblings)
              blockReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø–æ—Ç–æ–º–∫–∞–º–∏";
            else if (hasFather) blockReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –æ—Ç—Ü–æ–º";
            else if (hasFullSiblings)
              blockReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã–º–∏ –±—Ä–∞—Ç—å—è–º–∏/—Å–µ—Å—Ç—Ä–∞–º–∏";

            results.heirs.push({
              name:
                formData.heirs.paternalSisters === 1
                  ? "–°–µ—Å—Ç—Ä–∞ (–µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω–∞—è)"
                  : `–°–µ—Å—Ç—Ä—ã –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–µ (${formData.heirs.paternalSisters})`,
              relation: "–°–µ—Å—Ç—Ä–∞ –ø–æ–∫–æ–π–Ω–æ–≥–æ",
              baseFraction: new Fraction(0, 1),
              finalFraction: new Fraction(0, 1),
              percentage: 0,
              amount: 0,
              dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:176',
              blocked: true,
              blockedBy: blockReason,
            });
          }

          // –ï–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω—ã–µ –±—Ä–∞—Ç—å—è –∏ —Å–µ—Å—Ç—Ä—ã (–ø–æ –º–∞—Ç–µ—Ä–∏)
          const totalMaternalSiblings =
            formData.heirs.maternalBrothers + formData.heirs.maternalSisters;
          if (
            totalMaternalSiblings > 0 &&
            !hasDescendantsForSiblings &&
            !hasFather
          ) {
            const maternalSiblingShare =
              totalMaternalSiblings === 1 ? 1 / 6 : 1 / 3;
            const maternalSiblingFraction =
              totalMaternalSiblings === 1
                ? new Fraction(1, 6)
                : new Fraction(1, 3);

            if (formData.heirs.maternalBrothers > 0) {
              const individualShare =
                maternalSiblingShare / totalMaternalSiblings;
              const individualFraction = new Fraction(
                maternalSiblingFraction.num,
                maternalSiblingFraction.den * totalMaternalSiblings
              ).simplify();

              results.heirs.push({
                name:
                  formData.heirs.maternalBrothers === 1
                    ? "–ë—Ä–∞—Ç (–µ–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω—ã–π)"
                    : `–ë—Ä–∞—Ç—å—è –µ–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω—ã–µ (${formData.heirs.maternalBrothers})`,
                relation: "–ë—Ä–∞—Ç –ø–æ–∫–æ–π–Ω–æ–≥–æ",
                baseFraction: individualFraction,
                finalFraction: individualFraction,
                percentage:
                  individualShare * formData.heirs.maternalBrothers * 100,
                amount:
                  formData.totalEstate *
                  individualShare *
                  formData.heirs.maternalBrothers,
                dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:12',
                blocked: false,
                blockedBy: null,
              });
            }

            if (formData.heirs.maternalSisters > 0) {
              const individualShare =
                maternalSiblingShare / totalMaternalSiblings;
              const individualFraction = new Fraction(
                maternalSiblingFraction.num,
                maternalSiblingFraction.den * totalMaternalSiblings
              ).simplify();

              results.heirs.push({
                name:
                  formData.heirs.maternalSisters === 1
                    ? "–°–µ—Å—Ç—Ä–∞ (–µ–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω–∞—è)"
                    : `–°–µ—Å—Ç—Ä—ã –µ–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω—ã–µ (${formData.heirs.maternalSisters})`,
                relation: "–°–µ—Å—Ç—Ä–∞ –ø–æ–∫–æ–π–Ω–æ–≥–æ",
                baseFraction: individualFraction,
                finalFraction: individualFraction,
                percentage:
                  individualShare * formData.heirs.maternalSisters * 100,
                amount:
                  formData.totalEstate *
                  individualShare *
                  formData.heirs.maternalSisters,
                dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:12',
                blocked: false,
                blockedBy: null,
              });
            }
          } else if (totalMaternalSiblings > 0) {
            if (formData.heirs.maternalBrothers > 0) {
              results.heirs.push({
                name:
                  formData.heirs.maternalBrothers === 1
                    ? "–ë—Ä–∞—Ç (–µ–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω—ã–π)"
                    : `–ë—Ä–∞—Ç—å—è –µ–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω—ã–µ (${formData.heirs.maternalBrothers})`,
                relation: "–ë—Ä–∞—Ç –ø–æ–∫–æ–π–Ω–æ–≥–æ",
                baseFraction: new Fraction(0, 1),
                finalFraction: new Fraction(0, 1),
                percentage: 0,
                amount: 0,
                dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:12',
                blocked: true,
                blockedBy: hasDescendantsForSiblings
                  ? "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø–æ—Ç–æ–º–∫–∞–º–∏"
                  : "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –æ—Ç—Ü–æ–º",
              });
            }

            if (formData.heirs.maternalSisters > 0) {
              results.heirs.push({
                name:
                  formData.heirs.maternalSisters === 1
                    ? "–°–µ—Å—Ç—Ä–∞ (–µ–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω–∞—è)"
                    : `–°–µ—Å—Ç—Ä—ã –µ–¥–∏–Ω–æ—É—Ç—Ä–æ–±–Ω—ã–µ (${formData.heirs.maternalSisters})`,
                relation: "–°–µ—Å—Ç—Ä–∞ –ø–æ–∫–æ–π–Ω–æ–≥–æ",
                baseFraction: new Fraction(0, 1),
                finalFraction: new Fraction(0, 1),
                percentage: 0,
                amount: 0,
                dalil: '–ö–æ—Ä–∞–Ω, —Å—É—Ä–∞ "–∞–Ω-–ù–∏—Å–∞", 4:12',
                blocked: true,
                blockedBy: hasDescendantsForSiblings
                  ? "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø–æ—Ç–æ–º–∫–∞–º–∏"
                  : "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –æ—Ç—Ü–æ–º",
              });
            }
          }

          // –î–ê–õ–¨–ù–ò–ï –ê–°–ê–ê–ë–ê (–ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ –∏ –¥—è–¥–∏)
          // –°–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–∏–º, –∫—Ç–æ –∏–∑ –¥–∞–ª—å–Ω–∏—Ö –∞—Å–∞–∞–±–∞ –ø–æ–ª—É—á–∏—Ç –æ—Å—Ç–∞—Ç–æ–∫ (–µ—Å–ª–∏ –Ω–µ—Ç –±–ª–∏–∑–∫–∏—Ö)
          // –õ–æ–≥–∏–∫–∞: –¥–∞–ª—å–Ω–∏–µ –∞—Å–∞–∞–±–∞ –Ω–∞—Å–ª–µ–¥—É—é—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –±–æ–ª–µ–µ –±–ª–∏–∑–∫–∏—Ö –∞–≥–Ω–∞—Ç–æ–≤
          // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ –æ—Ç –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã—Ö > –ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ –æ—Ç –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã—Ö > –¥—è–¥–∏ —Ä–æ–¥–Ω—ã–µ > –¥—è–¥–∏ –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–µ

          const distantAsabaBlockReason = hasCloserAgnaticHeirs
            ? "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –±–æ–ª–µ–µ –±–ª–∏–∑–∫–∏–º–∏ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞–º–∏ (—Å—ã–Ω/–≤–Ω—É–∫/–æ—Ç–µ—Ü/–¥–µ–¥/–±—Ä–∞—Ç—å—è)"
            : null;

          // –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –∏ –æ—Å—Ç–∞—Ç–æ–∫
          let totalPercentage = results.heirs.reduce(
            (sum, heir) => sum + heir.percentage,
            0
          );

          // –ï—Å–ª–∏ —Å—É–º–º–∞ –¥–æ–ª–µ–π –ø—Ä–µ–≤—ã—à–∞–µ—Ç 100%, –ø—Ä–∏–º–µ–Ω—è–µ–º –∞–ª—å-–ê–≤–ª—å (–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —É–º–µ–Ω—å—à–∞–µ–º)
          if (totalPercentage > 100.0001) {
            const awlRatioValue = 100 / totalPercentage;
            const awlRatioFraction = Fraction.fromDecimal(awlRatioValue);

            results.awlApplied = true;
            results.awlRatio = awlRatioFraction;

            results.heirs = results.heirs.map((heir) => {
              const scaled = { ...heir };
              const originalPercentage = heir.percentage || 0;

              // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç –∏ –¥—Ä–æ–±—å –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞
              scaled.percentage = originalPercentage * awlRatioValue;
              if (heir.finalFraction && heir.finalFraction.multiply) {
                scaled.finalFraction = heir.finalFraction
                  .multiply(awlRatioFraction)
                  .simplify();
              }

              // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º—É –≤ –≤–∞–ª—é—Ç–µ
              scaled.amount = formData.totalEstate * (scaled.percentage / 100);

              return scaled;
            });

            // –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—É–º–º–∞—Ä–Ω—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∞–ª—å-–ê–≤–ª—å
            totalPercentage = results.heirs
              .filter((heir) => !heir.blocked)
              .reduce((sum, heir) => sum + (heir.percentage || 0), 0);
          }

          let remainderPct = Math.max(0, 100 - totalPercentage);
          let remainderAmount = formData.totalEstate * (remainderPct / 100);

          // –ï—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–µ—Ü –∏ –æ—Å—Ç–∞—Ç–æ–∫, –æ–Ω –∑–∞–±–∏—Ä–∞–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫ –∫–∞–∫ –∞—Å–∞–±–∞
          if (remainderPct > 0.0001 && formData.heirs.father) {
            const fatherHeir = results.heirs.find((h) => h.name === "–û—Ç–µ—Ü");
            if (fatherHeir) {
              const remainderFraction = Fraction.fromDecimal(
                remainderPct / 100
              );
              fatherHeir.finalFraction = fatherHeir.finalFraction
                .add(remainderFraction)
                .simplify();
              fatherHeir.baseFraction = fatherHeir.finalFraction.clone();
              fatherHeir.percentage += remainderPct;
              fatherHeir.amount += remainderAmount;

              // –ü–æ—Å–ª–µ –ø–µ—Ä–µ–¥–∞—á–∏ –æ—Å—Ç–∞—Ç–∫–∞ –æ—Ç—Ü—É –¥–æ–ª–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è
              remainderPct = 0;
              remainderAmount = 0;
            }
          }

          // –û—Å—Ç–∞—Ç–æ–∫ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –¥–∞–ª—å–Ω–∏–º –∞—Å–∞–±–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É, –µ—Å–ª–∏ –Ω–µ—Ç –±–ª–∏–∂–Ω–∏—Ö
          // –¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è–µ–º –¥–∞–ª—å–Ω–∏—Ö –∞—Å–∞–∞–±–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (—Å –¥–æ–ª–µ–π –∏–ª–∏ –∫–∞–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö)
          if (
            remainderPct > 0.0001 &&
            !formData.heirs.father &&
            !hasCloserAgnaticHeirs &&
            hasDistantAsabaCandidates
          ) {
            const remainderFraction = Fraction.fromDecimal(remainderPct / 100);

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞ —Å –¥–æ–ª–µ–π
            const createHeirWithShare = (count, name) => {
              const sharePerHeir = remainderFraction.divide(
                new Fraction(count, 1)
              );
              return {
                name: name,
                relation: "–ê—Å–∞–∞–±–∞ –ø–æ –ª–∏–Ω–∏–∏ –æ—Ç—Ü–∞",
                baseFraction: sharePerHeir.multiply(new Fraction(count, 1)),
                finalFraction: sharePerHeir.multiply(new Fraction(count, 1)),
                percentage: remainderPct,
                amount: remainderAmount,
                dalil:
                  "–ü–æ—Ä—è–¥–æ–∫ –∞—Å–∞–±–∞ –ø–æ –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏: —Å—ã–Ω ‚Üí –≤–Ω—É–∫ ‚Üí –æ—Ç–µ—Ü ‚Üí –¥–µ–¥ ‚Üí –±—Ä–∞—Ç—å—è ‚Üí –ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ ‚Üí –¥—è–¥–∏",
                blocked: false,
                blockedBy: null,
              };
            };

            let allocated = false;

            // 1) –°—ã–Ω—ã –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤ - –ø–æ–ª—É—á–∞—é—Ç –æ—Å—Ç–∞—Ç–æ–∫
            if (formData.heirs.nephewsFullBrothers > 0) {
              const name =
                formData.heirs.nephewsFullBrothers === 1
                  ? "–ü–ª–µ–º—è–Ω–Ω–∏–∫ (—Å—ã–Ω –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω–æ–≥–æ –±—Ä–∞—Ç–∞)"
                  : `–ü–ª–µ–º—è–Ω–Ω–∏–∫–∏ - —Å—ã–Ω—ã –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤ (${formData.heirs.nephewsFullBrothers})`;
              results.heirs.push(
                createHeirWithShare(formData.heirs.nephewsFullBrothers, name)
              );
              allocated = true;
            }

            // 2) –°—ã–Ω—ã –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤
            if (formData.heirs.nephewsPaternalBrothers > 0) {
              const name =
                formData.heirs.nephewsPaternalBrothers === 1
                  ? "–ü–ª–µ–º—è–Ω–Ω–∏–∫ (—Å—ã–Ω –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω–æ–≥–æ –±—Ä–∞—Ç–∞)"
                  : `–ü–ª–µ–º—è–Ω–Ω–∏–∫–∏ - —Å—ã–Ω—ã –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤ (${formData.heirs.nephewsPaternalBrothers})`;
              if (allocated) {
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
                results.heirs.push({
                  name: name,
                  relation: "–ê—Å–∞–∞–±–∞ –ø–æ –ª–∏–Ω–∏–∏ –æ—Ç—Ü–∞",
                  baseFraction: new Fraction(0, 1),
                  finalFraction: new Fraction(0, 1),
                  percentage: 0,
                  amount: 0,
                  dalil:
                    "–ü–æ—Ä—è–¥–æ–∫ –∞—Å–∞–±–∞ –ø–æ –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏: —Å—ã–Ω ‚Üí –≤–Ω—É–∫ ‚Üí –æ—Ç–µ—Ü ‚Üí –¥–µ–¥ ‚Üí –±—Ä–∞—Ç—å—è ‚Üí –ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ ‚Üí –¥—è–¥–∏",
                  blocked: true,
                  blockedBy: "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø–ª–µ–º—è–Ω–Ω–∏–∫–∞–º–∏ –æ—Ç –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤",
                });
              } else {
                results.heirs.push(
                  createHeirWithShare(
                    formData.heirs.nephewsPaternalBrothers,
                    name
                  )
                );
                allocated = true;
              }
            }

            // 3) –†–æ–¥–Ω—ã–µ –¥—è–¥–∏ (–±—Ä–∞—Ç—å—è –æ—Ç—Ü–∞)
            if (formData.heirs.unclesFull > 0) {
              const name =
                formData.heirs.unclesFull === 1
                  ? "–î—è–¥—è (—Ä–æ–¥–Ω–æ–π –±—Ä–∞—Ç –æ—Ç—Ü–∞)"
                  : `–î—è–¥–∏ - —Ä–æ–¥–Ω—ã–µ –±—Ä–∞—Ç—å—è –æ—Ç—Ü–∞ (${formData.heirs.unclesFull})`;
              if (allocated) {
                results.heirs.push({
                  name: name,
                  relation: "–ê—Å–∞–∞–±–∞ –ø–æ –ª–∏–Ω–∏–∏ –æ—Ç—Ü–∞",
                  baseFraction: new Fraction(0, 1),
                  finalFraction: new Fraction(0, 1),
                  percentage: 0,
                  amount: 0,
                  dalil:
                    "–ü–æ—Ä—è–¥–æ–∫ –∞—Å–∞–±–∞ –ø–æ –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏: —Å—ã–Ω ‚Üí –≤–Ω—É–∫ ‚Üí –æ—Ç–µ—Ü ‚Üí –¥–µ–¥ ‚Üí –±—Ä–∞—Ç—å—è ‚Üí –ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ ‚Üí –¥—è–¥–∏",
                  blocked: true,
                  blockedBy: "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø–ª–µ–º—è–Ω–Ω–∏–∫–∞–º–∏",
                });
              } else {
                results.heirs.push(
                  createHeirWithShare(formData.heirs.unclesFull, name)
                );
                allocated = true;
              }
            }

            // 4) –ï–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–µ –¥—è–¥–∏
            if (formData.heirs.unclesPaternal > 0) {
              const name =
                formData.heirs.unclesPaternal === 1
                  ? "–î—è–¥—è (–µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–π –±—Ä–∞—Ç –æ—Ç—Ü–∞)"
                  : `–î—è–¥–∏ - –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–µ –±—Ä–∞—Ç—å—è –æ—Ç—Ü–∞ (${formData.heirs.unclesPaternal})`;
              if (allocated) {
                const blockReason =
                  formData.heirs.unclesFull > 0
                    ? "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Ä–æ–¥–Ω—ã–º–∏ –¥—è–¥—è–º–∏"
                    : "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø–ª–µ–º—è–Ω–Ω–∏–∫–∞–º–∏";
                results.heirs.push({
                  name: name,
                  relation: "–ê—Å–∞–∞–±–∞ –ø–æ –ª–∏–Ω–∏–∏ –æ—Ç—Ü–∞",
                  baseFraction: new Fraction(0, 1),
                  finalFraction: new Fraction(0, 1),
                  percentage: 0,
                  amount: 0,
                  dalil:
                    "–ü–æ—Ä—è–¥–æ–∫ –∞—Å–∞–±–∞ –ø–æ –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏: —Å—ã–Ω ‚Üí –≤–Ω—É–∫ ‚Üí –æ—Ç–µ—Ü ‚Üí –¥–µ–¥ ‚Üí –±—Ä–∞—Ç—å—è ‚Üí –ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ ‚Üí –¥—è–¥–∏",
                  blocked: true,
                  blockedBy: blockReason,
                });
              } else {
                results.heirs.push(
                  createHeirWithShare(formData.heirs.unclesPaternal, name)
                );
                allocated = true;
              }
            }

            if (allocated) {
              remainderPct = 0;
              remainderAmount = 0;
            }
          } else if (hasDistantAsabaCandidates) {
            // –ï—Å–ª–∏ –µ—Å—Ç—å –±–ª–∏–∑–∫–∏–µ –∞–≥–Ω–∞—Ç—ã, –¥–æ–±–∞–≤–ª—è–µ–º –¥–∞–ª—å–Ω–∏—Ö –∞—Å–∞–∞–±–∞ –∫–∞–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
            if (formData.heirs.nephewsFullBrothers > 0) {
              results.heirs.push({
                name:
                  formData.heirs.nephewsFullBrothers === 1
                    ? "–ü–ª–µ–º—è–Ω–Ω–∏–∫ (—Å—ã–Ω –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω–æ–≥–æ –±—Ä–∞—Ç–∞)"
                    : `–ü–ª–µ–º—è–Ω–Ω–∏–∫–∏ - —Å—ã–Ω—ã –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤ (${formData.heirs.nephewsFullBrothers})`,
                relation: "–ê—Å–∞–∞–±–∞ –ø–æ –ª–∏–Ω–∏–∏ –æ—Ç—Ü–∞",
                baseFraction: new Fraction(0, 1),
                finalFraction: new Fraction(0, 1),
                percentage: 0,
                amount: 0,
                dalil:
                  "–ü–æ—Ä—è–¥–æ–∫ –∞—Å–∞–±–∞ –ø–æ –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏: —Å—ã–Ω ‚Üí –≤–Ω—É–∫ ‚Üí –æ—Ç–µ—Ü ‚Üí –¥–µ–¥ ‚Üí –±—Ä–∞—Ç—å—è ‚Üí –ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ ‚Üí –¥—è–¥–∏",
                blocked: true,
                blockedBy: distantAsabaBlockReason,
              });
            }

            if (formData.heirs.nephewsPaternalBrothers > 0) {
              let blockReason;
              if (hasCloserAgnaticHeirs) {
                blockReason = distantAsabaBlockReason;
              } else if (formData.heirs.nephewsFullBrothers > 0) {
                blockReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø–ª–µ–º—è–Ω–Ω–∏–∫–∞–º–∏ –æ—Ç –ø–æ–ª–Ω–æ—Ä–æ–¥–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤";
              } else {
                blockReason = distantAsabaBlockReason;
              }
              results.heirs.push({
                name:
                  formData.heirs.nephewsPaternalBrothers === 1
                    ? "–ü–ª–µ–º—è–Ω–Ω–∏–∫ (—Å—ã–Ω –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω–æ–≥–æ –±—Ä–∞—Ç–∞)"
                    : `–ü–ª–µ–º—è–Ω–Ω–∏–∫–∏ - —Å—ã–Ω—ã –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã—Ö –±—Ä–∞—Ç—å–µ–≤ (${formData.heirs.nephewsPaternalBrothers})`,
                relation: "–ê—Å–∞–∞–±–∞ –ø–æ –ª–∏–Ω–∏–∏ –æ—Ç—Ü–∞",
                baseFraction: new Fraction(0, 1),
                finalFraction: new Fraction(0, 1),
                percentage: 0,
                amount: 0,
                dalil:
                  "–ü–æ—Ä—è–¥–æ–∫ –∞—Å–∞–±–∞ –ø–æ –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏: —Å—ã–Ω ‚Üí –≤–Ω—É–∫ ‚Üí –æ—Ç–µ—Ü ‚Üí –¥–µ–¥ ‚Üí –±—Ä–∞—Ç—å—è ‚Üí –ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ ‚Üí –¥—è–¥–∏",
                blocked: true,
                blockedBy: blockReason,
              });
            }

            if (formData.heirs.unclesFull > 0) {
              const blockReason = hasCloserAgnaticHeirs
                ? distantAsabaBlockReason
                : "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø–ª–µ–º—è–Ω–Ω–∏–∫–∞–º–∏";
              results.heirs.push({
                name:
                  formData.heirs.unclesFull === 1
                    ? "–î—è–¥—è (—Ä–æ–¥–Ω–æ–π –±—Ä–∞—Ç –æ—Ç—Ü–∞)"
                    : `–î—è–¥–∏ - —Ä–æ–¥–Ω—ã–µ –±—Ä–∞—Ç—å—è –æ—Ç—Ü–∞ (${formData.heirs.unclesFull})`,
                relation: "–ê—Å–∞–∞–±–∞ –ø–æ –ª–∏–Ω–∏–∏ –æ—Ç—Ü–∞",
                baseFraction: new Fraction(0, 1),
                finalFraction: new Fraction(0, 1),
                percentage: 0,
                amount: 0,
                dalil:
                  "–ü–æ—Ä—è–¥–æ–∫ –∞—Å–∞–±–∞ –ø–æ –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏: —Å—ã–Ω ‚Üí –≤–Ω—É–∫ ‚Üí –æ—Ç–µ—Ü ‚Üí –¥–µ–¥ ‚Üí –±—Ä–∞—Ç—å—è ‚Üí –ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ ‚Üí –¥—è–¥–∏",
                blocked: true,
                blockedBy: blockReason,
              });
            }

            if (formData.heirs.unclesPaternal > 0) {
              let blockReason;
              if (hasCloserAgnaticHeirs) {
                blockReason = distantAsabaBlockReason;
              } else if (formData.heirs.unclesFull > 0) {
                blockReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Ä–æ–¥–Ω—ã–º–∏ –¥—è–¥—è–º–∏";
              } else {
                blockReason = "–ë–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –ø–ª–µ–º—è–Ω–Ω–∏–∫–∞–º–∏";
              }
              results.heirs.push({
                name:
                  formData.heirs.unclesPaternal === 1
                    ? "–î—è–¥—è (–µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–π –±—Ä–∞—Ç –æ—Ç—Ü–∞)"
                    : `–î—è–¥–∏ - –µ–¥–∏–Ω–æ–∫—Ä–æ–≤–Ω—ã–µ –±—Ä–∞—Ç—å—è –æ—Ç—Ü–∞ (${formData.heirs.unclesPaternal})`,
                relation: "–ê—Å–∞–∞–±–∞ –ø–æ –ª–∏–Ω–∏–∏ –æ—Ç—Ü–∞",
                baseFraction: new Fraction(0, 1),
                finalFraction: new Fraction(0, 1),
                percentage: 0,
                amount: 0,
                dalil:
                  "–ü–æ—Ä—è–¥–æ–∫ –∞—Å–∞–±–∞ –ø–æ –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏: —Å—ã–Ω ‚Üí –≤–Ω—É–∫ ‚Üí –æ—Ç–µ—Ü ‚Üí –¥–µ–¥ ‚Üí –±—Ä–∞—Ç—å—è ‚Üí –ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ ‚Üí –¥—è–¥–∏",
                blocked: true,
                blockedBy: blockReason,
              });
            }
          }

          // –ï—Å–ª–∏ –Ω–µ—Ç –±–ª–∏–∑–∫–∏—Ö –∞—Å–∞–±–∞, –Ω–æ –µ—Å—Ç—å –¥–∞–ª—å–Ω–∏–µ –∞—Å–∞–±–∞ –ø–æ –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏,
          // –æ—Ç–¥–∞—ë–º –∏–º –æ—Å—Ç–∞—Ç–æ–∫ (–ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ –ø–æ –±—Ä–∞—Ç—É, –¥—è–¥–∏ –ø–æ –æ—Ç—Ü—É –∏ —Ç.–¥.)
          if (remainderPct > 0.0001 && formData.heirs.otherPaternalAsaba) {
            const remainderFraction = Fraction.fromDecimal(remainderPct / 100);
            results.heirs.push({
              name: "–î–∞–ª—å–Ω–∏–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∏ –ø–æ –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏ (–∞—Å–∞–±)",
              relation: "–ê—Å–∞–∞–±–∞ –ø–æ –ª–∏–Ω–∏–∏ –æ—Ç—Ü–∞",
              baseFraction: remainderFraction,
              finalFraction: remainderFraction,
              percentage: remainderPct,
              amount: remainderAmount,
              dalil:
                "–ü–æ—Ä—è–¥–æ–∫ –∞—Å–∞–±–∞ –ø–æ –º—É–∂—Å–∫–æ–π –ª–∏–Ω–∏–∏: —Å—ã–Ω ‚Üí –≤–Ω—É–∫ ‚Üí –æ—Ç–µ—Ü ‚Üí –¥–µ–¥ ‚Üí –±—Ä–∞—Ç—å—è ‚Üí –ø–ª–µ–º—è–Ω–Ω–∏–∫–∏ ‚Üí –¥—è–¥–∏",
              blocked: false,
              blockedBy: null,
            });

            remainderPct = 0;
            remainderAmount = 0;
          }

          // –ï—Å–ª–∏ –æ—Å—Ç–∞–ª—Å—è –æ—Å—Ç–∞—Ç–æ–∫ –∏ –Ω–µ—Ç –æ—Å–æ–±–æ–≥–æ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞-–∞—Å–∞–∞–±–∞, –ø—Ä–∏–º–µ–Ω—è–µ–º –∞—Ä-–†–∞–¥–¥
          // –°—É–ø—Ä—É–≥–∏ –Ω–µ —É—á–∞—Å—Ç–≤—É—é—Ç –≤ –†–∞–¥–¥: –æ—Å—Ç–∞—Ç–æ–∫ –∏–º –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è, –æ–Ω –æ—Å—Ç–∞—ë—Ç—Å—è –∫–∞–∑–Ω–µ/—Å–∞–¥–∞–∫–µ
          if (remainderPct > 0.0001) {
            const raddEligible = results.heirs.filter((heir) => {
              if (heir.blocked || (heir.percentage || 0) === 0) return false;
              // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ heirType (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —è–∑—ã–∫–∞)
              const isSpouse =
                heir.heirType === "husband" || heir.heirType === "wife";
              return !isSpouse;
            });

            if (raddEligible.length > 0) {
              // –°—É–º–º–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ —Å—É–ø—Ä—É–≥–æ–≤ (–æ–Ω–∏ –Ω–µ —É—á–∞—Å—Ç–≤—É—é—Ç –≤ —Ä–∞–¥–¥)
              const spousePercentage = results.heirs
                .filter((heir) => {
                  const isSpouse =
                    heir.heirType === "husband" || heir.heirType === "wife";
                  return (
                    isSpouse && !heir.blocked && (heir.percentage || 0) > 0
                  );
                })
                .reduce((sum, heir) => sum + (heir.percentage || 0), 0);

              // –°—É–º–º–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ eligible –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤ (–±–µ–∑ —Å—É–ø—Ä—É–≥–æ–≤)
              const eligiblePercentage = raddEligible.reduce(
                (sum, heir) => sum + (heir.percentage || 0),
                0
              );

              // –û—Å—Ç–∞—Ç–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å = 100% - –¥–æ–ª—è —Å—É–ø—Ä—É–≥–æ–≤
              const availableForEligible = 100 - spousePercentage;

              // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è eligible –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤
              const raddRatioValue =
                eligiblePercentage > 0
                  ? availableForEligible / eligiblePercentage
                  : 1;
              const raddRatioFraction = Fraction.fromDecimal(raddRatioValue);

              results.raddApplied = true;
              results.raddRecipients = raddEligible.map((heir) => heir.name);

              results.heirs = results.heirs.map((heir) => {
                if (!raddEligible.includes(heir)) return heir;

                const scaled = { ...heir };
                scaled.percentage = (heir.percentage || 0) * raddRatioValue;
                if (heir.finalFraction && heir.finalFraction.multiply) {
                  scaled.finalFraction = heir.finalFraction
                    .multiply(raddRatioFraction)
                    .simplify();
                }
                if (heir.baseFraction && heir.baseFraction.multiply) {
                  scaled.baseFraction = heir.baseFraction
                    .multiply(raddRatioFraction)
                    .simplify();
                }
                scaled.amount =
                  formData.totalEstate * (scaled.percentage / 100);
                return scaled;
              });

              remainderPct = 0;
              remainderAmount = 0;
            }
          }

          results.remainder.percentage = remainderPct;
          results.remainder.amount = remainderAmount;

          return results;
        },
      };

      // ========================================
      // Tooltip Controller
      // ========================================
      const TooltipController = {
        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫
         */
        init() {
          this.bindEvents();
          this.setupAccessibility();
        },

        /**
         * –ü—Ä–∏–≤—è–∑–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
         */
        bindEvents() {
          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Å–µ–Ω—Å–æ—Ä–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
          document.addEventListener("touchstart", (e) => {
            if (e.target.classList.contains("tooltip")) {
              this.handleTouch(e);
            }
          });

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å)
          document.addEventListener("keydown", (e) => {
            if (
              e.target.classList.contains("tooltip") &&
              (e.key === "Enter" || e.key === " ")
            ) {
              e.preventDefault();
              this.toggleTooltip(e.target);
            }
          });

          // –ó–∞–∫—Ä—ã—Ç–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
          document.addEventListener("click", (e) => {
            if (!e.target.classList.contains("tooltip")) {
              this.hideAllTooltips();
            }
          });
        },

        /**
         * –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–æ–∫
         */
        setupAccessibility() {
          const tooltips = document.querySelectorAll(".tooltip");
          tooltips.forEach((tooltip) => {
            // –î–æ–±–∞–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
            tooltip.setAttribute("tabindex", "0");
            tooltip.setAttribute("role", "button");
            tooltip.setAttribute("aria-describedby", "tooltip-description");
            tooltip.setAttribute("aria-label", "–ü–æ–∫–∞–∑–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞");
          });
        },

        /**
         * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
         * @param {TouchEvent} e - —Å–æ–±—ã—Ç–∏–µ –∫–∞—Å–∞–Ω–∏—è
         */
        handleTouch(e) {
          e.preventDefault();
          const tooltip = e.target;

          // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
          this.toggleTooltip(tooltip);
        },

        /**
         * –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏
         * @param {HTMLElement} tooltip - —ç–ª–µ–º–µ–Ω—Ç —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π
         */
        toggleTooltip(tooltip) {
          const isActive = tooltip.classList.contains("tooltip-active");

          // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –¥—Ä—É–≥–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
          this.hideAllTooltips();

          if (!isActive) {
            tooltip.classList.add("tooltip-active");
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
              tooltip.classList.remove("tooltip-active");
            }, 5000);
          }
        },

        /**
         * –°–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏
         */
        hideAllTooltips() {
          const activeTooltips = document.querySelectorAll(".tooltip-active");
          activeTooltips.forEach((tooltip) => {
            tooltip.classList.remove("tooltip-active");
          });
        },
      };

      // ========================================
      // Mobile Utilities
      // ========================================
      const MobileUtils = {
        /**
         * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –º–æ–±–∏–ª—å–Ω—ã–º
         * @returns {boolean}
         */
        isMobile() {
          return globalThis.innerWidth <= 767;
        },

        /**
         * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å–µ–Ω—Å–æ—Ä–Ω—ã–º
         * @returns {boolean}
         */
        isTouchDevice() {
          return "ontouchstart" in globalThis || navigator.maxTouchPoints > 0;
        },

        /**
         * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∞
         */
        handleOrientationChange() {
          // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
          setTimeout(() => {
            this.adjustForOrientation();
          }, 100);
        },

        /**
         * –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–¥ —Ç–µ–∫—É—â—É—é –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é
         */
        adjustForOrientation() {
          const isLandscape = globalThis.innerWidth > globalThis.innerHeight;
          const isMobile = this.isMobile();

          if (isMobile && isLandscape) {
            // –£–º–µ–Ω—å—à–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã –≤ –∞–ª—å–±–æ–º–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
            document.documentElement.style.setProperty(
              "--container-padding",
              "0.5rem"
            );

            // –£–º–µ–Ω—å—à–∞–µ–º –≤—ã—Å–æ—Ç—É –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            const modal = document.getElementById("obligations-modal");
            if (modal) {
              modal.style.paddingTop = "0.5rem";
            }
          } else if (isMobile) {
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±—ã—á–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –≤ –ø–æ—Ä—Ç—Ä–µ—Ç–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
            document.documentElement.style.setProperty(
              "--container-padding",
              "1rem"
            );
          }
        },

        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç
         */
        init() {
          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
          globalThis.addEventListener("orientationchange", () => {
            this.handleOrientationChange();
          });

          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
          globalThis.addEventListener("resize", () => {
            this.adjustForOrientation();
          });

          // –ù–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
          this.adjustForOrientation();

          // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∑—É–º –ø—Ä–∏ –¥–≤–æ–π–Ω–æ–º —Ç–∞–ø–µ –Ω–∞ iOS
          if (this.isTouchDevice()) {
            let lastTouchEnd = 0;
            document.addEventListener(
              "touchend",
              (event) => {
                const now = Date.now();
                if (now - lastTouchEnd <= 300) {
                  event.preventDefault();
                }
                lastTouchEnd = now;
              },
              false
            );
          }
        },
      };

      // ========================================
      // Initialization
      // ========================================
      // –î–µ–ª–∏–º—Å—è –∫–ª—é—á–µ–≤—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤–æ –≤–Ω–µ—à–Ω–µ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö)
      globalThis.AppState = AppState;
      globalThis.FormController = FormController;
      globalThis.CalculationController = CalculationController;
      globalThis.ResultsController = ResultsController;

      document.addEventListener("DOMContentLoaded", () => {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç
        MobileUtils.init();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ (–®–∞–≥ 0)
        ModalController.init();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —Ñ–æ—Ä–º—ã (–®–∞–≥ 1)
        FormController.init();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        ResultsController.init();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —Ä–∞—Å—á–µ—Ç–æ–≤
        CalculationController.init();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –ø–æ–¥—Å–∫–∞–∑–æ–∫
        TooltipController.init();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –ø–∞–Ω–µ–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        I18n.init().then(() => {
          SettingsPanel.init();
        });
      });
    </script>


    <!-- Localization modules -->
    <script src="../src/i18n.js"></script>
    <script src="../src/settings-panel.js"></script>

    <!-- 100% privacy-first analytics -->
    <script
      async
      src="https://scripts.simpleanalyticscdn.com/latest.js"
    ></script>
  </body>
</html>
